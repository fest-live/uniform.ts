// deno-lint-ignore-file no-explicit-any ban-types
import { isPromise } from "fest/core";
import { TS } from "./Alias";
/*
 * Internal types of meta
 * ["@meta"|"@data"]: {
 *   !type: string, // interpretation type (how will resolved)
 *   !uuid: string, // located in remote storage pool
 *   !payload: any, // additional descriptions
 *   !index: number // located in transferable list
 * }
 */
// If someone not in list, will just copy or sharing
// @ts-ignore "Transferable list for web workers (automatic)"
export const Transferable = [
    /* @ts-ignore "" */ typeof ArrayBuffer != TS.udf ? ArrayBuffer : null,
    /* @ts-ignore "" */ typeof MessagePort != TS.udf ? MessagePort : null,
    /* @ts-ignore "" */ typeof ReadableStream != TS.udf ? ReadableStream : null,
    /* @ts-ignore "" */ typeof WritableStream != TS.udf ? WritableStream : null,
    /* @ts-ignore "" */ typeof TransformStream != TS.udf ? TransformStream : null,
    /* @ts-ignore "" */ typeof WebTransportReceiveStream != TS.udf ? WebTransportReceiveStream : null,
    /* @ts-ignore "" */ typeof WebTransportSendStream != TS.udf ? WebTransportSendStream : null,
    /* @ts-ignore "" */ typeof AudioData != TS.udf ? AudioData : null,
    /* @ts-ignore "" */ typeof ImageBitmap != TS.udf ? ImageBitmap : null,
    /* @ts-ignore "" */ typeof VideoFrame != TS.udf ? VideoFrame : null,
    /* @ts-ignore "" */ typeof OffscreenCanvas != TS.udf ? OffscreenCanvas : null,
    /* @ts-ignore "" */ typeof RTCDataChannel != TS.udf ? RTCDataChannel : null
].filter((E) => (E != null));
//
export const FORBIDDEN_KEYS = new Set(["bind", "toString", "then", "catch", "finally"]);
export const doOnlyAfterResolve = (meta, cb) => {
    if (isPromise(meta)) {
        const chain = meta?.then?.(cb)?.catch?.(console.trace.bind(console)) ?? cb(meta);
        //console.trace(chain);
        return chain;
    }
    return cb(meta);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlZnVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXNlZnVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGtEQUFrRDtBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFhN0I7Ozs7Ozs7O0dBUUc7QUFFSCxvREFBb0Q7QUFDcEQsNkRBQTZEO0FBQzdELE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRztJQUN4QixtQkFBbUIsQ0FBQyxPQUFPLFdBQVcsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUk7SUFDckUsbUJBQW1CLENBQUMsT0FBTyxXQUFXLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJO0lBQ3JFLG1CQUFtQixDQUFDLE9BQU8sY0FBYyxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSTtJQUMzRSxtQkFBbUIsQ0FBQyxPQUFPLGNBQWMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUk7SUFDM0UsbUJBQW1CLENBQUMsT0FBTyxlQUFlLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJO0lBQzdFLG1CQUFtQixDQUFDLE9BQU8seUJBQXlCLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLElBQUk7SUFDakcsbUJBQW1CLENBQUMsT0FBTyxzQkFBc0IsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsSUFBSTtJQUMzRixtQkFBbUIsQ0FBQyxPQUFPLFNBQVMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUk7SUFDakUsbUJBQW1CLENBQUMsT0FBTyxXQUFXLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJO0lBQ3JFLG1CQUFtQixDQUFDLE9BQU8sVUFBVSxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSTtJQUNuRSxtQkFBbUIsQ0FBQyxPQUFPLGVBQWUsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUk7SUFDN0UsbUJBQW1CLENBQUMsT0FBTyxjQUFjLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJO0NBQzlFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBRTdCLEVBQUU7QUFDRixNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsSUFBSSxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztBQUN4RixNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxDQUEwQixJQUFpQixFQUFFLEVBQXVDLEVBQStCLEVBQUU7SUFDbkosSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNsQixNQUFNLEtBQUssR0FBSSxJQUFZLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBUyxDQUFDLENBQUM7UUFDL0YsdUJBQXVCO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFDRCxPQUFPLEVBQUUsQ0FBQyxJQUFTLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBkZW5vLWxpbnQtaWdub3JlLWZpbGUgbm8tZXhwbGljaXQtYW55IGJhbi10eXBlc1xuaW1wb3J0IHsgaXNQcm9taXNlIH0gZnJvbSBcImZlc3QvY29yZVwiO1xuaW1wb3J0IHsgVFMgfSBmcm9tIFwiLi9BbGlhc1wiO1xuXG4vL1xuZXhwb3J0IHR5cGUgZFQgPSBvYmplY3QgfCBGdW5jdGlvbjtcbmV4cG9ydCB0eXBlIHJUID0gV2Vha1JlZjxkVD47XG5leHBvcnQgdHlwZSBNUHJvbWlzZTxUIGV4dGVuZHMgdW5rbm93bj4gPSBQcm9taXNlPFQ+IHwgVCB8IG51bGw7XG5leHBvcnQgdHlwZSBJV3JhcDxUIGV4dGVuZHMgdW5rbm93bj4gPSB7XG4gICAgW3BUIGluIGtleW9mIFRdOiBNUHJvbWlzZTxwVD4gfCBJV3JhcDxwVD47XG59O1xuXG4vL1xuZXhwb3J0IHR5cGUgRXhDaGFuZ2VyID0gYW55O1xuXG4vKlxuICogSW50ZXJuYWwgdHlwZXMgb2YgbWV0YVxuICogW1wiQG1ldGFcInxcIkBkYXRhXCJdOiB7XG4gKiAgICF0eXBlOiBzdHJpbmcsIC8vIGludGVycHJldGF0aW9uIHR5cGUgKGhvdyB3aWxsIHJlc29sdmVkKVxuICogICAhdXVpZDogc3RyaW5nLCAvLyBsb2NhdGVkIGluIHJlbW90ZSBzdG9yYWdlIHBvb2xcbiAqICAgIXBheWxvYWQ6IGFueSwgLy8gYWRkaXRpb25hbCBkZXNjcmlwdGlvbnNcbiAqICAgIWluZGV4OiBudW1iZXIgLy8gbG9jYXRlZCBpbiB0cmFuc2ZlcmFibGUgbGlzdFxuICogfVxuICovXG5cbi8vIElmIHNvbWVvbmUgbm90IGluIGxpc3QsIHdpbGwganVzdCBjb3B5IG9yIHNoYXJpbmdcbi8vIEB0cy1pZ25vcmUgXCJUcmFuc2ZlcmFibGUgbGlzdCBmb3Igd2ViIHdvcmtlcnMgKGF1dG9tYXRpYylcIlxuZXhwb3J0IGNvbnN0IFRyYW5zZmVyYWJsZSA9IFtcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIEFycmF5QnVmZmVyICE9IFRTLnVkZiA/IEFycmF5QnVmZmVyIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIE1lc3NhZ2VQb3J0ICE9IFRTLnVkZiA/IE1lc3NhZ2VQb3J0IDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIFJlYWRhYmxlU3RyZWFtICE9IFRTLnVkZiA/IFJlYWRhYmxlU3RyZWFtIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIFdyaXRhYmxlU3RyZWFtICE9IFRTLnVkZiA/IFdyaXRhYmxlU3RyZWFtIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIFRyYW5zZm9ybVN0cmVhbSAhPSBUUy51ZGYgPyBUcmFuc2Zvcm1TdHJlYW0gOiBudWxsLFxuICAgIC8qIEB0cy1pZ25vcmUgXCJcIiAqLyB0eXBlb2YgV2ViVHJhbnNwb3J0UmVjZWl2ZVN0cmVhbSAhPSBUUy51ZGYgPyBXZWJUcmFuc3BvcnRSZWNlaXZlU3RyZWFtIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIFdlYlRyYW5zcG9ydFNlbmRTdHJlYW0gIT0gVFMudWRmID8gV2ViVHJhbnNwb3J0U2VuZFN0cmVhbSA6IG51bGwsXG4gICAgLyogQHRzLWlnbm9yZSBcIlwiICovIHR5cGVvZiBBdWRpb0RhdGEgIT0gVFMudWRmID8gQXVkaW9EYXRhIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIEltYWdlQml0bWFwICE9IFRTLnVkZiA/IEltYWdlQml0bWFwIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIFZpZGVvRnJhbWUgIT0gVFMudWRmID8gVmlkZW9GcmFtZSA6IG51bGwsXG4gICAgLyogQHRzLWlnbm9yZSBcIlwiICovIHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT0gVFMudWRmID8gT2Zmc2NyZWVuQ2FudmFzIDogbnVsbCxcbiAgICAvKiBAdHMtaWdub3JlIFwiXCIgKi8gdHlwZW9mIFJUQ0RhdGFDaGFubmVsICE9IFRTLnVkZiA/IFJUQ0RhdGFDaGFubmVsIDogbnVsbFxuXS5maWx0ZXIoKEUpID0+IChFICE9IG51bGwpKTtcblxuLy9cbmV4cG9ydCBjb25zdCBGT1JCSURERU5fS0VZUyA9IG5ldyBTZXQoW1wiYmluZFwiLCBcInRvU3RyaW5nXCIsIFwidGhlblwiLCBcImNhdGNoXCIsIFwiZmluYWxseVwiXSk7XG5leHBvcnQgY29uc3QgZG9Pbmx5QWZ0ZXJSZXNvbHZlID0gPFQgZXh0ZW5kcyB1bmtub3duIHwgYW55PihtZXRhOiBNUHJvbWlzZTxUPiwgY2I6ICh1OiBUKSA9PiBNUHJvbWlzZTxUPiB8IG51bGwgfCB2b2lkKTogTVByb21pc2U8YW55PiB8IG51bGwgfCB2b2lkID0+IHtcbiAgICBpZiAoaXNQcm9taXNlKG1ldGEpKSB7XG4gICAgICAgIGNvbnN0IGNoYWluID0gKG1ldGEgYXMgYW55KT8udGhlbj8uKGNiKT8uY2F0Y2g/Lihjb25zb2xlLnRyYWNlLmJpbmQoY29uc29sZSkpID8/IGNiKG1ldGEgYXMgVCk7XG4gICAgICAgIC8vY29uc29sZS50cmFjZShjaGFpbik7XG4gICAgICAgIHJldHVybiBjaGFpbjtcbiAgICB9XG4gICAgcmV0dXJuIGNiKG1ldGEgYXMgVCk7XG59XG4iXX0=