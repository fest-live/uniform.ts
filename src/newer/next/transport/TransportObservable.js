/**
 * Transport Observable - Observable wrappers for transports
 *
 * Direct Observable wrapper:
 * - next() → postMessage/send
 * - subscribe() → addEventListener
 */
import { createTransportSender, createTransportListener } from "../../core/TransportCore";
import { ChannelSubject } from "../observable/Observable";
// ============================================================================
// BASE TRANSPORT OBSERVABLE
// ============================================================================
export class TransportObservable {
    _subs = new Set();
    _listening = false;
    _cleanup = null;
    subscribe(observerOrNext) {
        const obs = typeof observerOrNext === "function" ? { next: observerOrNext } : observerOrNext;
        const first = this._subs.size === 0;
        this._subs.add(obs);
        if (first && !this._listening)
            this._activate();
        return {
            closed: false,
            unsubscribe: () => {
                this._subs.delete(obs);
                if (this._subs.size === 0 && this._listening)
                    this._deactivate();
            }
        };
    }
    _deactivate() {
        this._cleanup?.();
        this._cleanup = null;
        this._listening = false;
    }
    _dispatch(value) {
        for (const s of this._subs) {
            try {
                s.next?.(value);
            }
            catch (e) {
                s.error?.(e);
            }
        }
    }
    _error(err) {
        for (const s of this._subs)
            s.error?.(err);
    }
    _complete() {
        for (const s of this._subs)
            s.complete?.();
        this._subs.clear();
        this._deactivate();
    }
    close() { this._complete(); }
    get subscriberCount() { return this._subs.size; }
    get isListening() { return this._listening; }
}
// ============================================================================
// CONCRETE IMPLEMENTATIONS
// ============================================================================
/** Worker Observable */
export class WorkerObservable extends TransportObservable {
    _worker;
    _send;
    constructor(_worker) {
        super();
        this._worker = _worker;
        this._send = createTransportSender(this._worker);
    }
    next(value, transfer) { this._send(value, transfer); }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener(this._worker, (d) => this._dispatch(d), (e) => this._error(e));
        this._listening = true;
    }
    terminate() { this._worker.terminate(); this._complete(); }
    get worker() { return this._worker; }
}
/** MessagePort Observable */
export class MessagePortObservable extends TransportObservable {
    _port;
    _send;
    constructor(_port) {
        super();
        this._port = _port;
        this._send = createTransportSender(this._port);
    }
    next(value, transfer) { this._send(value, transfer); }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener(this._port, (d) => this._dispatch(d));
        this._listening = true;
    }
    get port() { return this._port; }
}
/** BroadcastChannel Observable */
export class BroadcastChannelObservable extends TransportObservable {
    _name;
    _channel;
    _send;
    constructor(_name) {
        super();
        this._name = _name;
        this._channel = new BroadcastChannel(_name);
        this._send = createTransportSender(this._channel);
    }
    next(value) { this._send(value); }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener(this._channel, (d) => {
            if (d?.sender !== this._name)
                this._dispatch(d);
        });
        this._listening = true;
    }
    close() { this._channel.close(); super.close(); }
}
/** WebSocket Observable */
export class WebSocketObservable extends TransportObservable {
    _url;
    _protocols;
    _ws = null;
    _pending = [];
    _state = new ChannelSubject();
    constructor(_url, _protocols) {
        super();
        this._url = _url;
        this._protocols = _protocols;
    }
    connect() {
        if (this._ws)
            return;
        const url = typeof this._url === "string" ? this._url : this._url.href;
        this._ws = new WebSocket(url, this._protocols);
        this._state.next("connecting");
        this._ws.addEventListener("open", () => {
            this._state.next("open");
            this._pending.forEach((m) => this.next(m));
            this._pending = [];
        });
        this._cleanup = createTransportListener(this._ws, (d) => this._dispatch(d), (e) => this._error(e), () => { this._state.next("closed"); this._complete(); });
        this._listening = true;
    }
    next(value) {
        if (!this._ws || this._ws.readyState !== WebSocket.OPEN) {
            this._pending.push(value);
            return;
        }
        const { transferable: _, ...data } = value;
        this._ws.send(JSON.stringify(data));
    }
    _activate() { if (!this._ws)
        this.connect(); }
    close(code, reason) {
        this._state.next("closing");
        this._ws?.close(code, reason);
        this._ws = null;
        super.close();
    }
    get state() { return this._state; }
    get isOpen() { return this._ws?.readyState === WebSocket.OPEN; }
}
/** Chrome Runtime Observable */
export class ChromeRuntimeObservable extends TransportObservable {
    _send = createTransportSender("chrome-runtime");
    next(value) { this._send(value); }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener("chrome-runtime", (d) => this._dispatch(d));
        this._listening = true;
    }
}
/** Chrome Tabs Observable */
export class ChromeTabsObservable extends TransportObservable {
    _tabId;
    constructor(_tabId) {
        super();
        this._tabId = _tabId;
    }
    setTabId(id) { this._tabId = id; }
    next(value) {
        if (this._tabId == null || typeof chrome === "undefined" || !chrome.tabs)
            return;
        const { transferable: _, ...data } = value;
        chrome.tabs.sendMessage(this._tabId, data);
    }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener("chrome-tabs", (d) => this._dispatch(d), undefined, undefined, { tabId: this._tabId });
        this._listening = true;
    }
}
/** Chrome Port Observable */
export class ChromePortObservable extends TransportObservable {
    _portName;
    _tabId;
    _send;
    constructor(_portName, _tabId) {
        super();
        this._portName = _portName;
        this._tabId = _tabId;
        this._send = createTransportSender("chrome-port", { portName: _portName, tabId: _tabId });
    }
    next(value) {
        this._send(value);
    }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener("chrome-port", (d) => this._dispatch(d), undefined, undefined, { portName: this._portName, tabId: this._tabId });
        this._listening = true;
    }
}
/** ServiceWorker Client Observable */
export class ServiceWorkerClientObservable extends TransportObservable {
    _send = createTransportSender("service-worker-client");
    next(value, transfer) { this._send(value, transfer); }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener("service-worker-client", (d) => this._dispatch(d));
        this._listening = true;
    }
}
/** ServiceWorker Host Observable */
export class ServiceWorkerHostObservable extends TransportObservable {
    _send = createTransportSender("service-worker-host");
    next(value, transfer) {
        this._send(value, transfer);
    }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener("service-worker-host", (d) => this._dispatch(d));
        this._listening = true;
    }
}
/** Self Observable (inside worker) */
export class SelfObservable extends TransportObservable {
    _send = createTransportSender("self");
    next(value, transfer) { this._send(value, transfer); }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener("self", (d) => this._dispatch(d));
        this._listening = true;
    }
}
// ============================================================================
// FACTORY
// ============================================================================
export const TransportObservableFactory = {
    worker: (w) => new WorkerObservable(w),
    workerFromUrl: (url, opts) => new WorkerObservable(new Worker(typeof url === "string" ? url : url.href, { type: "module", ...opts })),
    messagePort: (p) => new MessagePortObservable(p),
    messageChannel: () => {
        const ch = new MessageChannel();
        return { port1: new MessagePortObservable(ch.port1), port2: new MessagePortObservable(ch.port2) };
    },
    broadcast: (name) => new BroadcastChannelObservable(name),
    websocket: (url, protocols) => new WebSocketObservable(url, protocols),
    chromeRuntime: () => new ChromeRuntimeObservable(),
    chromeTabs: (tabId) => new ChromeTabsObservable(tabId),
    chromePort: (portName, tabId) => new ChromePortObservable(portName, tabId),
    serviceWorkerClient: () => new ServiceWorkerClientObservable(),
    serviceWorkerHost: () => new ServiceWorkerHostObservable(),
    self: () => new SelfObservable()
};
// ============================================================================
// BIDIRECTIONAL CHANNEL
// ============================================================================
export function createBidirectionalChannel(outbound, inbound) {
    return {
        send: (v, t) => outbound.next(v, t),
        subscribe: (h) => inbound.subscribe({ next: h }),
        close: () => { outbound.close(); inbound.close(); }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhbnNwb3J0T2JzZXJ2YWJsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlRyYW5zcG9ydE9ic2VydmFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUNILHFCQUFxQixFQUNyQix1QkFBdUIsRUFFMUIsTUFBTSwwQkFBMEIsQ0FBQztBQUVsQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFMUQsK0VBQStFO0FBQy9FLDRCQUE0QjtBQUM1QiwrRUFBK0U7QUFFL0UsTUFBTSxPQUFnQixtQkFBbUI7SUFDM0IsS0FBSyxHQUFHLElBQUksR0FBRyxFQUFlLENBQUM7SUFDL0IsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUNuQixRQUFRLEdBQXdCLElBQUksQ0FBQztJQUkvQyxTQUFTLENBQUMsY0FBOEM7UUFDcEQsTUFBTSxHQUFHLEdBQWdCLE9BQU8sY0FBYyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQztRQUMxRyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFcEIsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVTtZQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUVoRCxPQUFPO1lBQ0gsTUFBTSxFQUFFLEtBQUs7WUFDYixXQUFXLEVBQUUsR0FBRyxFQUFFO2dCQUNkLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUN2QixJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsVUFBVTtvQkFBRSxJQUFJLENBQUMsV0FBVyxFQUFF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O0FBQy9FLHdCQUF3QjtBQUN4QiwrRUFBK0U7QUFFL0UsTUFBTSxVQUFVLDBCQUEwQixDQUN0QyxRQUFnQyxFQUNoQyxPQUErQjtJQUUvQixPQUFPO1FBQ0gsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLFNBQVMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUNoRCxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztLQUN0RCxDQUFDO0FBQ04sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVHJhbnNwb3J0IE9ic2VydmFibGUgLSBPYnNlcnZhYmxlIHdyYXBwZXJzIGZvciB0cmFuc3BvcnRzXG4gKlxuICogRGlyZWN0IE9ic2VydmFibGUgd3JhcHBlcjpcbiAqIC0gbmV4dCgpIOKGkiBwb3N0TWVzc2FnZS9zZW5kXG4gKiAtIHN1YnNjcmliZSgpIOKGkiBhZGRFdmVudExpc3RlbmVyXG4gKi9cblxuaW1wb3J0IHtcbiAgICBjcmVhdGVUcmFuc3BvcnRTZW5kZXIsXG4gICAgY3JlYXRlVHJhbnNwb3J0TGlzdGVuZXIsXG4gICAgdHlwZSBUcmFuc3BvcnRUYXJnZXRcbn0gZnJvbSBcIi4uLy4uL2NvcmUvVHJhbnNwb3J0Q29yZVwiO1xuaW1wb3J0IHR5cGUgeyBDaGFubmVsTWVzc2FnZSwgT2JzZXJ2ZXIsIFN1YnNjcmlwdGlvbiwgU3Vic2NyaWJhYmxlIH0gZnJvbSBcIi4uL3R5cGVzL0ludGVyZmFjZVwiO1xuaW1wb3J0IHsgQ2hhbm5lbFN1YmplY3QgfSBmcm9tIFwiLi4vb2JzZXJ2YWJsZS9PYnNlcnZhYmxlXCI7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEJBU0UgVFJBTlNQT1JUIE9CU0VSVkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRyYW5zcG9ydE9ic2VydmFibGU8VCA9IENoYW5uZWxNZXNzYWdlPiBpbXBsZW1lbnRzIFN1YnNjcmliYWJsZTxUPiB7XG4gICAgcHJvdGVjdGVkIF9zdWJzID0gbmV3IFNldDxPYnNlcnZlcjxUPj4oKTtcbiAgICBwcm90ZWN0ZWQgX2xpc3RlbmluZyA9IGZhbHNlO1xuICAgIHByb3RlY3RlZCBfY2xlYW51cDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG5cbiAgICBhYnN0cmFjdCBuZXh0KHZhbHVlOiBULCB0cmFuc2Zlcj86IFRyYW5zZmVyYWJsZVtdKTogdm9pZDtcblxuICAgIHN1YnNjcmliZShvYnNlcnZlck9yTmV4dDogT2JzZXJ2ZXI8VD4gfCAoKHY6IFQpID0+IHZvaWQpKTogU3Vic2NyaXB0aW9uIHtcbiAgICAgICAgY29uc3Qgb2JzOiBPYnNlcnZlcjxUPiA9IHR5cGVvZiBvYnNlcnZlck9yTmV4dCA9PT0gXCJmdW5jdGlvblwiID8geyBuZXh0OiBvYnNlcnZlck9yTmV4dCB9IDogb2JzZXJ2ZXJPck5leHQ7XG4gICAgICAgIGNvbnN0IGZpcnN0ID0gdGhpcy5fc3Vicy5zaXplID09PSAwO1xuICAgICAgICB0aGlzLl9zdWJzLmFkZChvYnMpO1xuXG4gICAgICAgIGlmIChmaXJzdCAmJiAhdGhpcy5fbGlzdGVuaW5nKSB0aGlzLl9hY3RpdmF0ZSgpO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjbG9zZWQ6IGZhbHNlLFxuICAgICAgICAgICAgdW5zdWJzY3JpYmU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzLmRlbGV0ZShvYnMpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdWJzLnNpemUgPT09IDAgJiYgdGhpcy5fbGlzdGVuaW5nKSB0aGlzLl9kZWFjdGl2YXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IF9hY3RpdmF0ZSgpOiB2b2lkO1xuXG4gICAgcHJvdGVjdGVkIF9kZWFjdGl2YXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9jbGVhbnVwPy4oKTtcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2xpc3RlbmluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfZGlzcGF0Y2godmFsdWU6IFQpOiB2b2lkIHtcbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHRoaXMuX3N1YnMpIHtcbiAgICAgICAgICAgIHRyeSB7IHMubmV4dD8uKHZhbHVlKTsgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgcy5lcnJvcj8uKGUgYXMgRXJyb3IpOyB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2Vycm9yKGVycjogRXJyb3IpOiB2b2lkIHtcbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHRoaXMuX3N1YnMpIHMuZXJyb3I/LihlcnIpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfY29tcGxldGUoKTogdm9pZCB7XG4gICAgICAgIGZvciAoY29uc3QgcyBvZiB0aGlzLl9zdWJzKSBzLmNvbXBsZXRlPy4oKTtcbiAgICAgICAgdGhpcy5fc3Vicy5jbGVhcigpO1xuICAgICAgICB0aGlzLl9kZWFjdGl2YXRlKCk7XG4gICAgfVxuXG4gICAgY2xvc2UoKTogdm9pZCB7IHRoaXMuX2NvbXBsZXRlKCk7IH1cbiAgICBnZXQgc3Vic2NyaWJlckNvdW50KCk6IG51bWJlciB7IHJldHVybiB0aGlzLl9zdWJzLnNpemU7IH1cbiAgICBnZXQgaXNMaXN0ZW5pbmcoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLl9saXN0ZW5pbmc7IH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OQ1JFVEUgSU1QTEVNRU5UQVRJT05TXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKiBXb3JrZXIgT2JzZXJ2YWJsZSAqL1xuZXhwb3J0IGNsYXNzIFdvcmtlck9ic2VydmFibGUgZXh0ZW5kcyBUcmFuc3BvcnRPYnNlcnZhYmxlPENoYW5uZWxNZXNzYWdlPiB7XG4gICAgcHJpdmF0ZSBfc2VuZDogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlVHJhbnNwb3J0U2VuZGVyPjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3dvcmtlcjogV29ya2VyKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX3NlbmQgPSBjcmVhdGVUcmFuc3BvcnRTZW5kZXIodGhpcy5fd29ya2VyKTtcbiAgICB9XG5cbiAgICBuZXh0KHZhbHVlOiBDaGFubmVsTWVzc2FnZSwgdHJhbnNmZXI/OiBUcmFuc2ZlcmFibGVbXSk6IHZvaWQgeyB0aGlzLl9zZW5kKHZhbHVlLCB0cmFuc2Zlcik7IH1cblxuICAgIHByb3RlY3RlZCBfYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5pbmcpIHJldHVybjtcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKHRoaXMuX3dvcmtlciwgKGQpID0+IHRoaXMuX2Rpc3BhdGNoKGQpLCAoZSkgPT4gdGhpcy5fZXJyb3IoZSkpO1xuICAgICAgICB0aGlzLl9saXN0ZW5pbmcgPSB0cnVlO1xuICAgIH1cblxuICAgIHRlcm1pbmF0ZSgpOiB2b2lkIHsgdGhpcy5fd29ya2VyLnRlcm1pbmF0ZSgpOyB0aGlzLl9jb21wbGV0ZSgpOyB9XG4gICAgZ2V0IHdvcmtlcigpOiBXb3JrZXIgeyByZXR1cm4gdGhpcy5fd29ya2VyOyB9XG59XG5cbi8qKiBNZXNzYWdlUG9ydCBPYnNlcnZhYmxlICovXG5leHBvcnQgY2xhc3MgTWVzc2FnZVBvcnRPYnNlcnZhYmxlIGV4dGVuZHMgVHJhbnNwb3J0T2JzZXJ2YWJsZTxDaGFubmVsTWVzc2FnZT4ge1xuICAgIHByaXZhdGUgX3NlbmQ6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZVRyYW5zcG9ydFNlbmRlcj47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9wb3J0OiBNZXNzYWdlUG9ydCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9zZW5kID0gY3JlYXRlVHJhbnNwb3J0U2VuZGVyKHRoaXMuX3BvcnQpO1xuICAgIH1cblxuICAgIG5leHQodmFsdWU6IENoYW5uZWxNZXNzYWdlLCB0cmFuc2Zlcj86IFRyYW5zZmVyYWJsZVtdKTogdm9pZCB7IHRoaXMuX3NlbmQodmFsdWUsIHRyYW5zZmVyKTsgfVxuXG4gICAgcHJvdGVjdGVkIF9hY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmluZykgcmV0dXJuO1xuICAgICAgICB0aGlzLl9jbGVhbnVwID0gY3JlYXRlVHJhbnNwb3J0TGlzdGVuZXIodGhpcy5fcG9ydCwgKGQpID0+IHRoaXMuX2Rpc3BhdGNoKGQpKTtcbiAgICAgICAgdGhpcy5fbGlzdGVuaW5nID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXQgcG9ydCgpOiBNZXNzYWdlUG9ydCB7IHJldHVybiB0aGlzLl9wb3J0OyB9XG59XG5cbi8qKiBCcm9hZGNhc3RDaGFubmVsIE9ic2VydmFibGUgKi9cbmV4cG9ydCBjbGFzcyBCcm9hZGNhc3RDaGFubmVsT2JzZXJ2YWJsZSBleHRlbmRzIFRyYW5zcG9ydE9ic2VydmFibGU8Q2hhbm5lbE1lc3NhZ2U+IHtcbiAgICBwcml2YXRlIF9jaGFubmVsOiBCcm9hZGNhc3RDaGFubmVsO1xuICAgIHByaXZhdGUgX3NlbmQ6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZVRyYW5zcG9ydFNlbmRlcj47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9uYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fY2hhbm5lbCA9IG5ldyBCcm9hZGNhc3RDaGFubmVsKF9uYW1lKTtcbiAgICAgICAgdGhpcy5fc2VuZCA9IGNyZWF0ZVRyYW5zcG9ydFNlbmRlcih0aGlzLl9jaGFubmVsKTtcbiAgICB9XG5cbiAgICBuZXh0KHZhbHVlOiBDaGFubmVsTWVzc2FnZSk6IHZvaWQgeyB0aGlzLl9zZW5kKHZhbHVlKTsgfVxuXG4gICAgcHJvdGVjdGVkIF9hY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmluZykgcmV0dXJuO1xuICAgICAgICB0aGlzLl9jbGVhbnVwID0gY3JlYXRlVHJhbnNwb3J0TGlzdGVuZXIodGhpcy5fY2hhbm5lbCwgKGQpID0+IHtcbiAgICAgICAgICAgIGlmIChkPy5zZW5kZXIgIT09IHRoaXMuX25hbWUpIHRoaXMuX2Rpc3BhdGNoKGQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fbGlzdGVuaW5nID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBjbG9zZSgpOiB2b2lkIHsgdGhpcy5fY2hhbm5lbC5jbG9zZSgpOyBzdXBlci5jbG9zZSgpOyB9XG59XG5cbi8qKiBXZWJTb2NrZXQgT2JzZXJ2YWJsZSAqL1xuZXhwb3J0IGNsYXNzIFdlYlNvY2tldE9ic2VydmFibGUgZXh0ZW5kcyBUcmFuc3BvcnRPYnNlcnZhYmxlPENoYW5uZWxNZXNzYWdlPiB7XG4gICAgcHJpdmF0ZSBfd3M6IFdlYlNvY2tldCB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgX3BlbmRpbmc6IENoYW5uZWxNZXNzYWdlW10gPSBbXTtcbiAgICBwcml2YXRlIF9zdGF0ZSA9IG5ldyBDaGFubmVsU3ViamVjdDxcImNvbm5lY3RpbmdcIiB8IFwib3BlblwiIHwgXCJjbG9zaW5nXCIgfCBcImNsb3NlZFwiPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfdXJsOiBzdHJpbmcgfCBVUkwsIHByaXZhdGUgX3Byb3RvY29scz86IHN0cmluZyB8IHN0cmluZ1tdKSB7IHN1cGVyKCk7IH1cblxuICAgIGNvbm5lY3QoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl93cykgcmV0dXJuO1xuICAgICAgICBjb25zdCB1cmwgPSB0eXBlb2YgdGhpcy5fdXJsID09PSBcInN0cmluZ1wiID8gdGhpcy5fdXJsIDogdGhpcy5fdXJsLmhyZWY7XG4gICAgICAgIHRoaXMuX3dzID0gbmV3IFdlYlNvY2tldCh1cmwsIHRoaXMuX3Byb3RvY29scyk7XG4gICAgICAgIHRoaXMuX3N0YXRlLm5leHQoXCJjb25uZWN0aW5nXCIpO1xuXG4gICAgICAgIHRoaXMuX3dzLmFkZEV2ZW50TGlzdGVuZXIoXCJvcGVuXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLm5leHQoXCJvcGVuXCIpO1xuICAgICAgICAgICAgdGhpcy5fcGVuZGluZy5mb3JFYWNoKChtKSA9PiB0aGlzLm5leHQobSkpO1xuICAgICAgICAgICAgdGhpcy5fcGVuZGluZyA9IFtdO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl9jbGVhbnVwID0gY3JlYXRlVHJhbnNwb3J0TGlzdGVuZXIoXG4gICAgICAgICAgICB0aGlzLl93cyxcbiAgICAgICAgICAgIChkKSA9PiB0aGlzLl9kaXNwYXRjaChkKSxcbiAgICAgICAgICAgIChlKSA9PiB0aGlzLl9lcnJvcihlKSxcbiAgICAgICAgICAgICgpID0+IHsgdGhpcy5fc3RhdGUubmV4dChcImNsb3NlZFwiKTsgdGhpcy5fY29tcGxldGUoKTsgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9saXN0ZW5pbmcgPSB0cnVlO1xuICAgIH1cblxuICAgIG5leHQodmFsdWU6IENoYW5uZWxNZXNzYWdlKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5fd3MgfHwgdGhpcy5fd3MucmVhZHlTdGF0ZSAhPT0gV2ViU29ja2V0Lk9QRU4pIHtcbiAgICAgICAgICAgIHRoaXMuX3BlbmRpbmcucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyB0cmFuc2ZlcmFibGU6IF8sIC4uLmRhdGEgfSA9IHZhbHVlIGFzIGFueTtcbiAgICAgICAgdGhpcy5fd3Muc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9hY3RpdmF0ZSgpOiB2b2lkIHsgaWYgKCF0aGlzLl93cykgdGhpcy5jb25uZWN0KCk7IH1cblxuICAgIGNsb3NlKGNvZGU/OiBudW1iZXIsIHJlYXNvbj86IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLl9zdGF0ZS5uZXh0KFwiY2xvc2luZ1wiKTtcbiAgICAgICAgdGhpcy5fd3M/LmNsb3NlKGNvZGUsIHJlYXNvbik7XG4gICAgICAgIHRoaXMuX3dzID0gbnVsbDtcbiAgICAgICAgc3VwZXIuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBnZXQgc3RhdGUoKTogU3Vic2NyaWJhYmxlPHN0cmluZz4geyByZXR1cm4gdGhpcy5fc3RhdGU7IH1cbiAgICBnZXQgaXNPcGVuKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fd3M/LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOOyB9XG59XG5cbi8qKiBDaHJvbWUgUnVudGltZSBPYnNlcnZhYmxlICovXG5leHBvcnQgY2xhc3MgQ2hyb21lUnVudGltZU9ic2VydmFibGUgZXh0ZW5kcyBUcmFuc3BvcnRPYnNlcnZhYmxlPENoYW5uZWxNZXNzYWdlPiB7XG4gICAgcHJpdmF0ZSBfc2VuZCA9IGNyZWF0ZVRyYW5zcG9ydFNlbmRlcihcImNocm9tZS1ydW50aW1lXCIpO1xuXG4gICAgbmV4dCh2YWx1ZTogQ2hhbm5lbE1lc3NhZ2UpOiB2b2lkIHsgdGhpcy5fc2VuZCh2YWx1ZSk7IH1cblxuICAgIHByb3RlY3RlZCBfYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5pbmcpIHJldHVybjtcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKFwiY2hyb21lLXJ1bnRpbWVcIiwgKGQpID0+IHRoaXMuX2Rpc3BhdGNoKGQpKTtcbiAgICAgICAgdGhpcy5fbGlzdGVuaW5nID0gdHJ1ZTtcbiAgICB9XG59XG5cbi8qKiBDaHJvbWUgVGFicyBPYnNlcnZhYmxlICovXG5leHBvcnQgY2xhc3MgQ2hyb21lVGFic09ic2VydmFibGUgZXh0ZW5kcyBUcmFuc3BvcnRPYnNlcnZhYmxlPENoYW5uZWxNZXNzYWdlPiB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfdGFiSWQ/OiBudW1iZXIpIHsgc3VwZXIoKTsgfVxuXG4gICAgc2V0VGFiSWQoaWQ6IG51bWJlcik6IHZvaWQgeyB0aGlzLl90YWJJZCA9IGlkOyB9XG5cbiAgICBuZXh0KHZhbHVlOiBDaGFubmVsTWVzc2FnZSk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5fdGFiSWQgPT0gbnVsbCB8fCB0eXBlb2YgY2hyb21lID09PSBcInVuZGVmaW5lZFwiIHx8ICFjaHJvbWUudGFicykgcmV0dXJuO1xuICAgICAgICBjb25zdCB7IHRyYW5zZmVyYWJsZTogXywgLi4uZGF0YSB9ID0gdmFsdWUgYXMgYW55O1xuICAgICAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0aGlzLl90YWJJZCwgZGF0YSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9hY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmluZykgcmV0dXJuO1xuICAgICAgICB0aGlzLl9jbGVhbnVwID0gY3JlYXRlVHJhbnNwb3J0TGlzdGVuZXIoXG4gICAgICAgICAgICBcImNocm9tZS10YWJzXCIsXG4gICAgICAgICAgICAoZCkgPT4gdGhpcy5fZGlzcGF0Y2goZCksXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICB7IHRhYklkOiB0aGlzLl90YWJJZCB9XG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX2xpc3RlbmluZyA9IHRydWU7XG4gICAgfVxufVxuXG4vKiogQ2hyb21lIFBvcnQgT2JzZXJ2YWJsZSAqL1xuZXhwb3J0IGNsYXNzIENocm9tZVBvcnRPYnNlcnZhYmxlIGV4dGVuZHMgVHJhbnNwb3J0T2JzZXJ2YWJsZTxDaGFubmVsTWVzc2FnZT4ge1xuICAgIHByaXZhdGUgX3NlbmQ6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZVRyYW5zcG9ydFNlbmRlcj47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9wb3J0TmFtZTogc3RyaW5nLCBwcml2YXRlIF90YWJJZD86IG51bWJlcikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9zZW5kID0gY3JlYXRlVHJhbnNwb3J0U2VuZGVyKFwiY2hyb21lLXBvcnRcIiwgeyBwb3J0TmFtZTogX3BvcnROYW1lLCB0YWJJZDogX3RhYklkIH0pO1xuICAgIH1cblxuICAgIG5leHQodmFsdWU6IENoYW5uZWxNZXNzYWdlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX3NlbmQodmFsdWUpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5pbmcpIHJldHVybjtcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKFxuICAgICAgICAgICAgXCJjaHJvbWUtcG9ydFwiLFxuICAgICAgICAgICAgKGQpID0+IHRoaXMuX2Rpc3BhdGNoKGQpLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgeyBwb3J0TmFtZTogdGhpcy5fcG9ydE5hbWUsIHRhYklkOiB0aGlzLl90YWJJZCB9XG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX2xpc3RlbmluZyA9IHRydWU7XG4gICAgfVxufVxuXG4vKiogU2VydmljZVdvcmtlciBDbGllbnQgT2JzZXJ2YWJsZSAqL1xuZXhwb3J0IGNsYXNzIFNlcnZpY2VXb3JrZXJDbGllbnRPYnNlcnZhYmxlIGV4dGVuZHMgVHJhbnNwb3J0T2JzZXJ2YWJsZTxDaGFubmVsTWVzc2FnZT4ge1xuICAgIHByaXZhdGUgX3NlbmQgPSBjcmVhdGVUcmFuc3BvcnRTZW5kZXIoXCJzZXJ2aWNlLXdvcmtlci1jbGllbnRcIik7XG5cbiAgICBuZXh0KHZhbHVlOiBDaGFubmVsTWVzc2FnZSwgdHJhbnNmZXI/OiBUcmFuc2ZlcmFibGVbXSk6IHZvaWQgeyB0aGlzLl9zZW5kKHZhbHVlLCB0cmFuc2Zlcik7IH1cblxuICAgIHByb3RlY3RlZCBfYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5pbmcpIHJldHVybjtcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKFwic2VydmljZS13b3JrZXItY2xpZW50XCIsIChkKSA9PiB0aGlzLl9kaXNwYXRjaChkKSk7XG4gICAgICAgIHRoaXMuX2xpc3RlbmluZyA9IHRydWU7XG4gICAgfVxufVxuXG4vKiogU2VydmljZVdvcmtlciBIb3N0IE9ic2VydmFibGUgKi9cbmV4cG9ydCBjbGFzcyBTZXJ2aWNlV29ya2VySG9zdE9ic2VydmFibGUgZXh0ZW5kcyBUcmFuc3BvcnRPYnNlcnZhYmxlPENoYW5uZWxNZXNzYWdlICYgeyBfY2xpZW50SWQ/OiBzdHJpbmcgfT4ge1xuICAgIHByaXZhdGUgX3NlbmQgPSBjcmVhdGVUcmFuc3BvcnRTZW5kZXIoXCJzZXJ2aWNlLXdvcmtlci1ob3N0XCIpO1xuXG4gICAgbmV4dCh2YWx1ZTogQ2hhbm5lbE1lc3NhZ2UgJiB7IF9jbGllbnRJZD86IHN0cmluZyB9LCB0cmFuc2Zlcj86IFRyYW5zZmVyYWJsZVtdKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX3NlbmQodmFsdWUsIHRyYW5zZmVyKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2FjdGl2YXRlKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5fbGlzdGVuaW5nKSByZXR1cm47XG4gICAgICAgIHRoaXMuX2NsZWFudXAgPSBjcmVhdGVUcmFuc3BvcnRMaXN0ZW5lcihcInNlcnZpY2Utd29ya2VyLWhvc3RcIiwgKGQpID0+IHRoaXMuX2Rpc3BhdGNoKGQpKTtcbiAgICAgICAgdGhpcy5fbGlzdGVuaW5nID0gdHJ1ZTtcbiAgICB9XG59XG5cbi8qKiBTZWxmIE9ic2VydmFibGUgKGluc2lkZSB3b3JrZXIpICovXG5leHBvcnQgY2xhc3MgU2VsZk9ic2VydmFibGUgZXh0ZW5kcyBUcmFuc3BvcnRPYnNlcnZhYmxlPENoYW5uZWxNZXNzYWdlPiB7XG4gICAgcHJpdmF0ZSBfc2VuZCA9IGNyZWF0ZVRyYW5zcG9ydFNlbmRlcihcInNlbGZcIik7XG5cbiAgICBuZXh0KHZhbHVlOiBDaGFubmVsTWVzc2FnZSwgdHJhbnNmZXI/OiBUcmFuc2ZlcmFibGVbXSk6IHZvaWQgeyB0aGlzLl9zZW5kKHZhbHVlLCB0cmFuc2Zlcik7IH1cblxuICAgIHByb3RlY3RlZCBfYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5pbmcpIHJldHVybjtcbiAgICAgICAgdGhpcy5fY2xlYW51cCA9IGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKFwic2VsZlwiLCAoZCkgPT4gdGhpcy5fZGlzcGF0Y2goZCkpO1xuICAgICAgICB0aGlzLl9saXN0ZW5pbmcgPSB0cnVlO1xuICAgIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRkFDVE9SWVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY29uc3QgVHJhbnNwb3J0T2JzZXJ2YWJsZUZhY3RvcnkgPSB7XG4gICAgd29ya2VyOiAodzogV29ya2VyKSA9PiBuZXcgV29ya2VyT2JzZXJ2YWJsZSh3KSxcbiAgICB3b3JrZXJGcm9tVXJsOiAodXJsOiBzdHJpbmcgfCBVUkwsIG9wdHM/OiBXb3JrZXJPcHRpb25zKSA9PlxuICAgICAgICBuZXcgV29ya2VyT2JzZXJ2YWJsZShuZXcgV29ya2VyKHR5cGVvZiB1cmwgPT09IFwic3RyaW5nXCIgPyB1cmwgOiB1cmwuaHJlZiwgeyB0eXBlOiBcIm1vZHVsZVwiLCAuLi5vcHRzIH0pKSxcbiAgICBtZXNzYWdlUG9ydDogKHA6IE1lc3NhZ2VQb3J0KSA9PiBuZXcgTWVzc2FnZVBvcnRPYnNlcnZhYmxlKHApLFxuICAgIG1lc3NhZ2VDaGFubmVsOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNoID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XG4gICAgICAgIHJldHVybiB7IHBvcnQxOiBuZXcgTWVzc2FnZVBvcnRPYnNlcnZhYmxlKGNoLnBvcnQxKSwgcG9ydDI6IG5ldyBNZXNzYWdlUG9ydE9ic2VydmFibGUoY2gucG9ydDIpIH07XG4gICAgfSxcbiAgICBicm9hZGNhc3Q6IChuYW1lOiBzdHJpbmcpID0+IG5ldyBCcm9hZGNhc3RDaGFubmVsT2JzZXJ2YWJsZShuYW1lKSxcbiAgICB3ZWJzb2NrZXQ6ICh1cmw6IHN0cmluZyB8IFVSTCwgcHJvdG9jb2xzPzogc3RyaW5nIHwgc3RyaW5nW10pID0+IG5ldyBXZWJTb2NrZXRPYnNlcnZhYmxlKHVybCwgcHJvdG9jb2xzKSxcbiAgICBjaHJvbWVSdW50aW1lOiAoKSA9PiBuZXcgQ2hyb21lUnVudGltZU9ic2VydmFibGUoKSxcbiAgICBjaHJvbWVUYWJzOiAodGFiSWQ/OiBudW1iZXIpID0+IG5ldyBDaHJvbWVUYWJzT2JzZXJ2YWJsZSh0YWJJZCksXG4gICAgY2hyb21lUG9ydDogKHBvcnROYW1lOiBzdHJpbmcsIHRhYklkPzogbnVtYmVyKSA9PiBuZXcgQ2hyb21lUG9ydE9ic2VydmFibGUocG9ydE5hbWUsIHRhYklkKSxcbiAgICBzZXJ2aWNlV29ya2VyQ2xpZW50OiAoKSA9PiBuZXcgU2VydmljZVdvcmtlckNsaWVudE9ic2VydmFibGUoKSxcbiAgICBzZXJ2aWNlV29ya2VySG9zdDogKCkgPT4gbmV3IFNlcnZpY2VXb3JrZXJIb3N0T2JzZXJ2YWJsZSgpLFxuICAgIHNlbGY6ICgpID0+IG5ldyBTZWxmT2JzZXJ2YWJsZSgpXG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBCSURJUkVDVElPTkFMIENIQU5ORUxcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUJpZGlyZWN0aW9uYWxDaGFubmVsPFQgPSBDaGFubmVsTWVzc2FnZT4oXG4gICAgb3V0Ym91bmQ6IFRyYW5zcG9ydE9ic2VydmFibGU8VD4sXG4gICAgaW5ib3VuZDogVHJhbnNwb3J0T2JzZXJ2YWJsZTxUPlxuKTogeyBzZW5kOiAodjogVCwgdD86IFRyYW5zZmVyYWJsZVtdKSA9PiB2b2lkOyBzdWJzY3JpYmU6IChoOiAodjogVCkgPT4gdm9pZCkgPT4gU3Vic2NyaXB0aW9uOyBjbG9zZTogKCkgPT4gdm9pZCB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZW5kOiAodiwgdCkgPT4gb3V0Ym91bmQubmV4dCh2LCB0KSxcbiAgICAgICAgc3Vic2NyaWJlOiAoaCkgPT4gaW5ib3VuZC5zdWJzY3JpYmUoeyBuZXh0OiBoIH0pLFxuICAgICAgICBjbG9zZTogKCkgPT4geyBvdXRib3VuZC5jbG9zZSgpOyBpbmJvdW5kLmNsb3NlKCk7IH1cbiAgICB9O1xufVxuIl19