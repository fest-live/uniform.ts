import { makeRequestProxy } from "../proxy/RequestProxy";
import { UUIDv4, deref, isCanJustReturn, isNotComplexArray } from "fest/core";
import { isPrimitive } from "fest/core";
import { SELF_CHANNEL } from "../channel/Channels";
//
const rg = "register";
//
// TODO: planned promised...
export default class UUIDMap {
    #weakMap = new WeakMap();
    #refMap = new Map();
    #registry = new FinalizationRegistry((_) => { });
    #linked = new Map();
    //
    constructor() {
        this.#linked = new Map();
        this.#weakMap = new WeakMap();
        this.#refMap = new Map();
        this.#registry = new FinalizationRegistry((key) => {
            this.#refMap.delete(key);
        });
    }
    // when transfer out required
    delete(key) {
        if (typeof key == "object" || typeof key == "function") {
            return this.#weakMap.delete(key);
        }
        return this.#refMap.delete(key);
    }
    //
    add(obj, id = "", force = false) {
        obj = (obj instanceof WeakRef ? obj?.deref?.() : obj);
        if (!(typeof obj == "object" || typeof obj == "function"))
            return obj;
        // never override already added, except transfer cases
        if (id && this.#refMap.has(id) && !force) {
            return id;
        }
        ;
        if (this.#weakMap.has(obj)) {
            return this.#weakMap.get(obj);
        }
        ;
        //
        this.#weakMap.set(obj, (id ||= UUIDv4()));
        this.#refMap.set(id, new WeakRef(this.count(obj) ?? obj));
        this.#registry?.[rg]?.(obj, id);
        //
        return id;
    }
    //
    discount(obj) {
        obj = (obj instanceof WeakRef ? obj?.deref?.() : obj);
        obj = (typeof obj == "object" || typeof obj == "function") ? obj : this.#refMap.get(obj);
        obj = (obj instanceof WeakRef ? obj?.deref?.() : obj);
        if (!obj)
            return obj;
        const hold = this.#linked?.get?.(obj) || 0;
        if (hold <= 1) {
            this.#linked.delete(obj);
        }
        else {
            this.#linked.set(obj, hold - 1);
        }
        return obj;
    }
    //
    count(obj) {
        obj = obj instanceof WeakRef ? obj?.deref?.() : obj;
        if (!obj)
            return obj;
        const hold = this.#linked.get(obj);
        if (!hold) {
            this.#linked.set(obj, 1);
        }
        else {
            this.#linked.set(obj, hold + 1);
        }
        return obj;
    }
    //
    has(key) {
        if (typeof key == "object" || typeof key == "function") {
            return this.#weakMap.has(key);
        }
        return this.#refMap.has(key);
    }
    //
    get(key) {
        if (typeof key == "object" || typeof key == "function") {
            return this.#weakMap.get(this.count(key));
        }
        return deref(this.#refMap.get(key));
    }
}
//
export const handMap = new WeakMap();
export const wrapMap = new WeakMap();
export const descMap = new WeakMap();
//
export const READ = (target, key) => {
    return handMap.get(target)?.[key];
};
//
export const objectToRef = (obj, channel = SELF_CHANNEL?.name, toTransfer) => {
    if ((typeof obj == "object" && obj != null) || typeof obj == "function" && obj != null) {
        if (wrapMap.has(obj))
            return wrapMap.get(obj);
        if (handMap.has(obj))
            return handMap.get(obj);
        if (isNotComplexArray(obj))
            return obj;
        if (toTransfer?.includes?.(obj))
            return obj;
        if (channel == SELF_CHANNEL?.name)
            return obj;
        return {
            $isDescriptor: true,
            path: registeredInPath.get(obj) ?? (() => {
                const path = [UUIDv4()];
                writeByPath(path, obj);
                return path;
            })(),
            owner: SELF_CHANNEL?.name,
            channel: channel,
            primitive: isPrimitive(obj),
            writable: true,
            enumerable: true,
            configurable: true,
            argumentCount: obj instanceof Function ? obj.length : -1
        };
    }
    return isCanJustReturn(obj) ? obj : null;
};
//
export const $requestHandler = Symbol.for("@requestHandler");
export const $descriptor = Symbol.for("@descriptor");
// wrap back to usable proxies
export const normalizeRef = (v) => {
    if (isCanJustReturn(v))
        return v;
    if (v?.[$descriptor])
        return v;
    if (v?.$isDescriptor)
        return makeRequestProxy(v, {});
    if (isNotComplexArray(v))
        return v;
    return null;
};
//
export const unwrapDescriptorFromProxy = (target) => {
    if ((typeof target != "function" && typeof target != "object") || target == null) {
        return target;
    }
    return wrapMap.get(target) ?? handMap.get(target) ?? target;
};
// unwrap in arrays, objects keys, values, etc. recursively
export const unwrapDescriptorFromProxyRecursive = (target) => {
    if ((typeof target != "object" && typeof target != "function") || target == null) {
        return target;
    }
    target = unwrapDescriptorFromProxy(target);
    if ((typeof target != "object" && typeof target != "function") || target == null) {
        return target;
    }
    if (Array.isArray(target)) {
        return target.map(unwrapDescriptorFromProxyRecursive);
    }
    if (target instanceof Map) {
        return new Map(Array.from(target.entries()).map(([key, value]) => [key, unwrapDescriptorFromProxyRecursive(value)]));
    }
    if (target instanceof Set) {
        return new Set(Array.from(target.values()).map(unwrapDescriptorFromProxyRecursive));
    }
    if (typeof target == "object") {
        for (const key of Object.keys(target)) {
            target[key] = unwrapDescriptorFromProxyRecursive(target[key]);
        }
    }
    return target;
};
//
export const storedData = new Map();
export const registeredInPath = new WeakMap();
//
export const traverseByPath = (obj, path) => {
    if (path != null && !Array.isArray(path)) {
        path = [path];
    }
    if (path == null || path?.length < 1) {
        return obj;
    }
    // if descriptor exists, unwrap it...
    const $desc = obj?.[$descriptor] ?? (obj?.$isDescriptor ? obj : null);
    if ($desc && $desc?.owner == SELF_CHANNEL?.name) {
        obj = readByPath($desc?.path) ?? obj;
    }
    if (isPrimitive(obj)) {
        return obj;
    }
    for (const key of path) {
        obj = obj?.[key];
        if (obj == null) {
            return obj;
        }
    }
    return obj;
};
// TODO: async support
export const readByPath = (path) => {
    if (path != null && !Array.isArray(path)) {
        path = [path];
    }
    if (path == null || path?.length < 1) {
        return null;
    }
    const root = storedData?.get?.(path?.[0]) ?? null;
    return root != null ? traverseByPath(root, path?.slice?.(1)) : null;
};
// TODO: async support
export const writeByPath = (path, data) => {
    // if descriptor exists, unwrap it...
    const $desc = data?.[$descriptor] ?? (data?.$isDescriptor ? data : null);
    if ($desc && $desc?.owner == SELF_CHANNEL?.name) {
        data = readByPath($desc?.path) ?? data;
    }
    //
    if (path != null && !Array.isArray(path)) {
        path = [path];
    }
    if (path == null || path?.length < 1) {
        return null;
    }
    const root = storedData?.get?.(path?.[0]) ?? null;
    if (path?.length > 1) {
        traverseByPath(root, path?.slice?.(1, -1))[path?.[path?.length - 1]] = data;
    }
    else {
        storedData?.set?.(path?.[0], data);
    }
    if (typeof data == "object" || typeof data == "function") {
        registeredInPath?.set?.(data, path);
    }
    return data;
};
//
export const removeByPath = (path) => {
    if (path != null && !Array.isArray(path)) {
        path = [path];
    }
    if (path == null || path?.length < 1) {
        return false;
    }
    const root = storedData?.get?.(path?.[0]) ?? null;
    if (!root && path?.length <= 1) {
        storedData?.delete?.(path?.[0]);
        return true;
    }
    else {
        return false;
    }
    delete traverseByPath(root, path?.slice?.(1, -1))[path?.[path?.length - 1]];
    if ((typeof root == "object" || typeof root == "function") && path?.length <= 1) {
        registeredInPath?.delete?.(root);
    }
    return true;
};
//
export const removeByData = (data) => {
    // if descriptor exists, unwrap it...
    const $desc = data?.[$descriptor] ?? (data?.$isDescriptor ? data : null);
    if ($desc && $desc?.owner == SELF_CHANNEL?.name) {
        data = readByPath($desc?.path) ?? data;
    }
    //
    const path = registeredInPath?.get?.(data) ?? $desc?.path;
    if (path == null || path?.length < 1) {
        return false;
    }
    ;
    removeByPath(path);
    if (typeof data == "object" || typeof data == "function") {
        registeredInPath?.delete?.(data);
    }
    return true;
};
//
export const hasNoPath = (data) => {
    const $desc = data?.[$descriptor] ?? (data?.$isDescriptor ? data : null);
    return (registeredInPath?.get?.(data) ?? $desc?.path) == null;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0YUJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJEYXRhQmFzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN4QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFbkQsRUFBRTtBQUNGLE1BQU0sRUFBRSxHQUFHLFVBQVUsQ0FBQztBQUV0QixFQUFFO0FBQ0YsNEJBQTRCO0FBQzVCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sT0FBTztJQUN4QixRQUFRLEdBQUcsSUFBSSxPQUFPLEVBQWMsQ0FBQztJQUNyQyxPQUFPLEdBQUcsSUFBSSxHQUFHLEVBQWMsQ0FBQztJQUNoQyxTQUFTLEdBQUcsSUFBSSxvQkFBb0IsQ0FBUyxDQUFDLENBQVMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDakUsT0FBTyxHQUFHLElBQUksR0FBRyxFQUFjLENBQUM7SUFFaEMsRUFBRTtJQUNGO1FBQ0ksSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBYyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxPQUFPLEVBQWMsQ0FBQztRQUMxQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksR0FBRyxFQUFjLENBQUM7UUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLG9CQUFvQixDQUFTLENBQUMsR0FBVyxFQUFFLEVBQUU7WUFDOUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsNkJBQTZCO0lBQzdCLE1BQU0sQ0FBd0IsR0FBTTtRQUNoQyxJQUFJLE9BQU8sR0FBRyxJQUFJLFFBQVEsSUFBSSxPQUFPLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNyRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFlLEdBQUksQ0FBQyxDQUFDO1FBQ3BELENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFtQixHQUFJLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQsRUFBRTtJQUNGLEdBQUcsQ0FBQyxHQUFPLEVBQUUsS0FBYSxFQUFFLEVBQUUsS0FBSyxHQUFHLEtBQUs7UUFDdkMsR0FBRyxHQUFHLENBQUMsR0FBRyxZQUFZLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBUSxDQUFDO1FBQzdELElBQUksQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLFFBQVEsSUFBSSxPQUFPLEdBQUcsSUFBSSxVQUFVLENBQUM7WUFBRSxPQUFPLEdBQUcsQ0FBQztRQUV0RSxzREFBc0Q7UUFDdEQsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUFDLE9BQU8sRUFBRSxDQUFDO1FBQUMsQ0FBQztRQUFBLENBQUM7UUFDekQsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQUMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUFDLENBQUM7UUFBQSxDQUFDO1FBRS9ELEVBQUU7UUFDRixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEtBQUssTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLE9BQU8sQ0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWhDLEVBQUU7UUFDRixPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFFRCxFQUFFO0lBQ0YsUUFBUSxDQUFDLEdBQVE7UUFDYixHQUFHLEdBQUcsQ0FBQyxHQUFHLFlBQVksT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFRLENBQUM7UUFDN0QsR0FBRyxHQUFHLENBQUMsT0FBTyxHQUFHLElBQUksUUFBUSxJQUFJLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFtQixHQUFJLENBQUMsQ0FBQztRQUM1RyxHQUFHLEdBQUcsQ0FBQyxHQUFHLFlBQVksT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFRLENBQUM7UUFDN0QsSUFBSSxDQUFDLEdBQUc7WUFBRSxPQUFPLEdBQUcsQ0FBQztRQUNyQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQUMsQ0FBQzthQUFNLENBQUM7WUFBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQUMsQ0FBQztRQUN0RixPQUFPLEdBQUcsQ0FBQztJQUNm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QUksQ0FBQztJQUMzQyxDQUFDO0lBRUQsRUFBRTtJQUNGLE1BQU0sSUFBSSxHQUFHLGdCQUFnQixFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssRUFBRSxJQUFJLENBQUM7SUFDMUQsSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFBQyxPQUFPLEtBQUssQ0FBQztJQUFDLENBQUM7SUFBQSxDQUFDO0lBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVFLElBQUksT0FBTyxJQUFJLElBQUksUUFBUSxJQUFJLE9BQU8sSUFBSSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQUMsZ0JBQWdCLEVBQUUsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7SUFBQyxDQUFDO0lBQy9GLE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUMsQ0FBQTtBQUVELEVBQUU7QUFDRixNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxJQUFTLEVBQUUsRUFBRTtJQUNuQyxNQUFNLEtBQUssR0FBRyxJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekUsT0FBTyxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUM7QUFDbEUsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gZGVuby1saW50LWlnbm9yZS1maWxlIG5vLWV4cGxpY2l0LWFueVxuaW1wb3J0IHsgdHlwZSBXUmVmbGVjdERlc2NyaXB0b3IgfSBmcm9tIFwiLi4vdHlwZXMvSW50ZXJmYWNlXCI7XG5pbXBvcnQgeyBtYWtlUmVxdWVzdFByb3h5IH0gZnJvbSBcIi4uL3Byb3h5L1JlcXVlc3RQcm94eVwiO1xuaW1wb3J0IHsgdHlwZSBkVCwgdHlwZSByVCB9IGZyb20gXCIuLi8uLi9jb3JlL1VzZWZ1bFwiO1xuaW1wb3J0IHsgVVVJRHY0LCBkZXJlZiwgaXNDYW5KdXN0UmV0dXJuLCBpc05vdENvbXBsZXhBcnJheSB9IGZyb20gXCJmZXN0L2NvcmVcIjtcbmltcG9ydCB7IGlzUHJpbWl0aXZlIH0gZnJvbSBcImZlc3QvY29yZVwiO1xuaW1wb3J0IHsgU0VMRl9DSEFOTkVMIH0gZnJvbSBcIi4uL2NoYW5uZWwvQ2hhbm5lbHNcIjtcblxuLy9cbmNvbnN0IHJnID0gXCJyZWdpc3RlclwiO1xuXG4vL1xuLy8gVE9ETzogcGxhbm5lZCBwcm9taXNlZC4uLlxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVVVJRE1hcDxUID0gZFQ+IHtcbiAgICAjd2Vha01hcCA9IG5ldyBXZWFrTWFwPGRULCBzdHJpbmc+KCk7XG4gICAgI3JlZk1hcCA9IG5ldyBNYXA8c3RyaW5nLCByVD4oKTtcbiAgICAjcmVnaXN0cnkgPSBuZXcgRmluYWxpemF0aW9uUmVnaXN0cnk8c3RyaW5nPigoXzogc3RyaW5nKSA9PiB7IH0pO1xuICAgICNsaW5rZWQgPSBuZXcgTWFwPGRULCBudW1iZXI+KCk7XG5cbiAgICAvL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLiNsaW5rZWQgPSBuZXcgTWFwPGRULCBudW1iZXI+KCk7XG4gICAgICAgIHRoaXMuI3dlYWtNYXAgPSBuZXcgV2Vha01hcDxkVCwgc3RyaW5nPigpO1xuICAgICAgICB0aGlzLiNyZWZNYXAgPSBuZXcgTWFwPHN0cmluZywgclQ+KCk7XG4gICAgICAgIHRoaXMuI3JlZ2lzdHJ5ID0gbmV3IEZpbmFsaXphdGlvblJlZ2lzdHJ5PHN0cmluZz4oKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICB0aGlzLiNyZWZNYXAuZGVsZXRlKGtleSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHdoZW4gdHJhbnNmZXIgb3V0IHJlcXVpcmVkXG4gICAgZGVsZXRlPFIgZXh0ZW5kcyBkVCB8IHN0cmluZz4oa2V5OiBSKTogdW5rbm93biB7XG4gICAgICAgIGlmICh0eXBlb2Yga2V5ID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGtleSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiN3ZWFrTWFwLmRlbGV0ZSg8ZFQ+KDx1bmtub3duPmtleSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLiNyZWZNYXAuZGVsZXRlKDxzdHJpbmc+KDx1bmtub3duPmtleSkpO1xuICAgIH1cblxuICAgIC8vXG4gICAgYWRkKG9iajogZFQsIGlkOiBzdHJpbmcgPSBcIlwiLCBmb3JjZSA9IGZhbHNlKSB7XG4gICAgICAgIG9iaiA9IChvYmogaW5zdGFuY2VvZiBXZWFrUmVmID8gb2JqPy5kZXJlZj8uKCkgOiBvYmopIGFzIGFueTtcbiAgICAgICAgaWYgKCEodHlwZW9mIG9iaiA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBvYmogPT0gXCJmdW5jdGlvblwiKSkgcmV0dXJuIG9iajtcblxuICAgICAgICAvLyBuZXZlciBvdmVycmlkZSBhbHJlYWR5IGFkZGVkLCBleGNlcHQgdHJhbnNmZXIgY2FzZXNcbiAgICAgICAgaWYgKGlkICYmIHRoaXMuI3JlZk1hcC5oYXMoaWQpICYmICFmb3JjZSkgeyByZXR1cm4gaWQ7IH07XG4gICAgICAgIGlmICh0aGlzLiN3ZWFrTWFwLmhhcyhvYmopKSB7IHJldHVybiB0aGlzLiN3ZWFrTWFwLmdldChvYmopOyB9O1xuXG4gICAgICAgIC8vXG4gICAgICAgIHRoaXMuI3dlYWtNYXAuc2V0KG9iaiwgKGlkIHx8PSBVVUlEdjQoKSkpO1xuICAgICAgICB0aGlzLiNyZWZNYXAuc2V0KGlkLCBuZXcgV2Vha1JlZjxkVD4odGhpcy5jb3VudChvYmopID8/IG9iaikpO1xuICAgICAgICB0aGlzLiNyZWdpc3RyeT8uW3JnXT8uKG9iaiwgaWQpO1xuXG4gICAgICAgIC8vXG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9XG5cbiAgICAvL1xuICAgIGRpc2NvdW50KG9iaj86IHJUKTogZFQgfCB1bmRlZmluZWQge1xuICAgICAgICBvYmogPSAob2JqIGluc3RhbmNlb2YgV2Vha1JlZiA/IG9iaj8uZGVyZWY/LigpIDogb2JqKSBhcyBhbnk7XG4gICAgICAgIG9iaiA9ICh0eXBlb2Ygb2JqID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIG9iaiA9PSBcImZ1bmN0aW9uXCIpID8gb2JqIDogdGhpcy4jcmVmTWFwLmdldCg8c3RyaW5nPig8dW5rbm93bj5vYmopKTtcbiAgICAgICAgb2JqID0gKG9iaiBpbnN0YW5jZW9mIFdlYWtSZWYgPyBvYmo/LmRlcmVmPy4oKSA6IG9iaikgYXMgYW55O1xuICAgICAgICBpZiAoIW9iaikgcmV0dXJuIG9iajtcbiAgICAgICAgY29uc3QgaG9sZCA9IHRoaXMuI2xpbmtlZD8uZ2V0Py4ob2JqKSB8fCAwO1xuICAgICAgICBpZiAoaG9sZCA8PSAxKSB7IHRoaXMuI2xpbmtlZC5kZWxldGUob2JqKTsgfSBlbHNlIHsgdGhpcy4jbGlua2VkLnNldChvYmosIGhvbGQgLSAxKTsgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIC8vXG4gICAgY291bnQob2JqPzogZFQpOiBkVCB8IHVuZGVmaW5lZCB7XG4gICAgICAgIG9iaiA9IG9iaiBpbnN0YW5jZW9mIFdlYWtSZWYgPyBvYmo/LmRlcmVmPy4oKSA6IG9iajtcbiAgICAgICAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gICAgICAgIGNvbnN0IGhvbGQgPSB0aGlzLiNsaW5rZWQuZ2V0KG9iaik7XG4gICAgICAgIGlmICghaG9sZCkgeyB0aGlzLiNsaW5rZWQuc2V0KG9iaiwgMSk7IH0gZWxzZSB7IHRoaXMuI2xpbmtlZC5zZXQob2JqLCBob2xkICsgMSk7IH1cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG5cbiAgICAvL1xuICAgIGhhczxSIGV4dGVuZHMgZFQgfCBzdHJpbmc+KGtleTogUik6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodHlwZW9mIGtleSA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBrZXkgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4jd2Vha01hcC5oYXMoPGRUPig8dW5rbm93bj5rZXkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy4jcmVmTWFwLmhhcyg8c3RyaW5nPig8dW5rbm93bj5rZXkpKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIGdldDxSIGV4dGVuZHMgZFQgfCBzdHJpbmc+KGtleTogUik6IHVua25vd24ge1xuICAgICAgICBpZiAodHlwZW9mIGtleSA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBrZXkgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4jd2Vha01hcC5nZXQoPGRUPnRoaXMuY291bnQoPGFueT5rZXkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVyZWYodGhpcy4jcmVmTWFwLmdldCg8c3RyaW5nPig8dW5rbm93bj5rZXkpKSk7XG4gICAgfVxufVxuXG5cbi8vXG5leHBvcnQgY29uc3QgaGFuZE1hcCA9IG5ldyBXZWFrTWFwPEZ1bmN0aW9uLCBXUmVmbGVjdERlc2NyaXB0b3I+KCk7XG5leHBvcnQgY29uc3Qgd3JhcE1hcCA9IG5ldyBXZWFrTWFwPEZ1bmN0aW9uLCBXUmVmbGVjdERlc2NyaXB0b3I+KCk7XG5leHBvcnQgY29uc3QgZGVzY01hcCA9IG5ldyBXZWFrTWFwPFdSZWZsZWN0RGVzY3JpcHRvciwgRnVuY3Rpb24+KCk7XG5cbi8vXG5leHBvcnQgY29uc3QgUkVBRCA9IDxUPWFueT4odGFyZ2V0OiBhbnksIGtleTogc3RyaW5nKTogVCA9PiB7XG4gICAgcmV0dXJuIGhhbmRNYXAuZ2V0KHRhcmdldCk/LltrZXldO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IG9iamVjdFRvUmVmID0gKG9iajogYW55LCBjaGFubmVsOiBzdHJpbmcgPSBTRUxGX0NIQU5ORUw/Lm5hbWUsIHRvVHJhbnNmZXI/OiBhbnlbXSk6IFdSZWZsZWN0RGVzY3JpcHRvcnxhbnl8bnVsbHx1bmRlZmluZWQgPT57XG4gICAgaWYgKCh0eXBlb2Ygb2JqID09IFwib2JqZWN0XCIgJiYgb2JqICE9IG51bGwpIHx8IHR5cGVvZiBvYmogPT0gXCJmdW5jdGlvblwiICYmIG9iaiAhPSBudWxsKSB7XG4gICAgICAgIGlmICh3cmFwTWFwLmhhcyhvYmopKSByZXR1cm4gd3JhcE1hcC5nZXQob2JqKTtcbiAgICAgICAgaWYgKGhhbmRNYXAuaGFzKG9iaikpIHJldHVybiBoYW5kTWFwLmdldChvYmopO1xuICAgICAgICBpZiAoaXNOb3RDb21wbGV4QXJyYXkob2JqKSkgcmV0dXJuIG9iajtcbiAgICAgICAgaWYgKHRvVHJhbnNmZXI/LmluY2x1ZGVzPy4ob2JqKSkgcmV0dXJuIG9iajtcbiAgICAgICAgaWYgKGNoYW5uZWwgPT0gU0VMRl9DSEFOTkVMPy5uYW1lKSByZXR1cm4gb2JqO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJGlzRGVzY3JpcHRvcjogdHJ1ZSxcbiAgICAgICAgICAgIHBhdGg6IHJlZ2lzdGVyZWRJblBhdGguZ2V0KG9iaikgPz8gKCgpPT57XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aDogc3RyaW5nW10gPSBbVVVJRHY0KCldO1xuICAgICAgICAgICAgICAgIHdyaXRlQnlQYXRoKHBhdGgsIG9iaik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICAgICAgICB9KSgpLFxuICAgICAgICAgICAgb3duZXI6IFNFTEZfQ0hBTk5FTD8ubmFtZSxcbiAgICAgICAgICAgIGNoYW5uZWw6IGNoYW5uZWwsXG4gICAgICAgICAgICBwcmltaXRpdmU6IGlzUHJpbWl0aXZlKG9iaiksXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICBhcmd1bWVudENvdW50OiBvYmogaW5zdGFuY2VvZiBGdW5jdGlvbiA/IG9iai5sZW5ndGggOiAtMVxuICAgICAgICB9IGFzIFdSZWZsZWN0RGVzY3JpcHRvcjtcbiAgICB9XG4gICAgcmV0dXJuIGlzQ2FuSnVzdFJldHVybihvYmopID8gb2JqIDogbnVsbDtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCAkcmVxdWVzdEhhbmRsZXIgPSBTeW1ib2wuZm9yKFwiQHJlcXVlc3RIYW5kbGVyXCIpO1xuZXhwb3J0IGNvbnN0ICRkZXNjcmlwdG9yID0gU3ltYm9sLmZvcihcIkBkZXNjcmlwdG9yXCIpO1xuXG4vLyB3cmFwIGJhY2sgdG8gdXNhYmxlIHByb3hpZXNcbmV4cG9ydCBjb25zdCBub3JtYWxpemVSZWYgPSAodjogYW55KT0+e1xuICAgIGlmIChpc0Nhbkp1c3RSZXR1cm4odikpIHJldHVybiB2O1xuICAgIGlmICh2Py5bJGRlc2NyaXB0b3JdKSByZXR1cm4gdjtcbiAgICBpZiAodj8uJGlzRGVzY3JpcHRvcikgcmV0dXJuIG1ha2VSZXF1ZXN0UHJveHkodiwge30pO1xuICAgIGlmIChpc05vdENvbXBsZXhBcnJheSh2KSkgcmV0dXJuIHY7XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbi8vXG5leHBvcnQgY29uc3QgdW53cmFwRGVzY3JpcHRvckZyb21Qcm94eSA9ICh0YXJnZXQ6IGFueSk9PntcbiAgICBpZiAoKHR5cGVvZiB0YXJnZXQgIT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiB0YXJnZXQgIT0gXCJvYmplY3RcIikgfHwgdGFyZ2V0ID09IG51bGwpIHsgcmV0dXJuIHRhcmdldDsgfVxuICAgIHJldHVybiB3cmFwTWFwLmdldCh0YXJnZXQpID8/IGhhbmRNYXAuZ2V0KHRhcmdldCkgPz8gdGFyZ2V0O1xufVxuXG4vLyB1bndyYXAgaW4gYXJyYXlzLCBvYmplY3RzIGtleXMsIHZhbHVlcywgZXRjLiByZWN1cnNpdmVseVxuZXhwb3J0IGNvbnN0IHVud3JhcERlc2NyaXB0b3JGcm9tUHJveHlSZWN1cnNpdmUgPSAodGFyZ2V0OiBhbnkpPT57XG4gICAgaWYgKCh0eXBlb2YgdGFyZ2V0ICE9IFwib2JqZWN0XCIgJiYgdHlwZW9mIHRhcmdldCAhPSBcImZ1bmN0aW9uXCIpIHx8IHRhcmdldCA9PSBudWxsKSB7IHJldHVybiB0YXJnZXQ7IH1cbiAgICB0YXJnZXQgPSB1bndyYXBEZXNjcmlwdG9yRnJvbVByb3h5KHRhcmdldCk7XG4gICAgaWYgKCh0eXBlb2YgdGFyZ2V0ICE9IFwib2JqZWN0XCIgJiYgdHlwZW9mIHRhcmdldCAhPSBcImZ1bmN0aW9uXCIpIHx8IHRhcmdldCA9PSBudWxsKSB7IHJldHVybiB0YXJnZXQ7IH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldC5tYXAodW53cmFwRGVzY3JpcHRvckZyb21Qcm94eVJlY3Vyc2l2ZSk7XG4gICAgfVxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBNYXApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXAoQXJyYXkuZnJvbSh0YXJnZXQuZW50cmllcygpKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgdW53cmFwRGVzY3JpcHRvckZyb21Qcm94eVJlY3Vyc2l2ZSh2YWx1ZSldKSk7XG4gICAgfVxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBTZXQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTZXQoQXJyYXkuZnJvbSh0YXJnZXQudmFsdWVzKCkpLm1hcCh1bndyYXBEZXNjcmlwdG9yRnJvbVByb3h5UmVjdXJzaXZlKSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModGFyZ2V0KSkge1xuICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSB1bndyYXBEZXNjcmlwdG9yRnJvbVByb3h5UmVjdXJzaXZlKHRhcmdldFtrZXldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0O1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IHN0b3JlZERhdGEgPSBuZXcgTWFwKCk7XG5leHBvcnQgY29uc3QgcmVnaXN0ZXJlZEluUGF0aCA9IG5ldyBXZWFrTWFwKCk7XG5cbi8vXG5leHBvcnQgY29uc3QgdHJhdmVyc2VCeVBhdGggPSAob2JqOiBhbnksIHBhdGg6IHN0cmluZ1tdKSA9PiB7XG4gICAgaWYgKHBhdGggIT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwYXRoKSkgeyBwYXRoID0gW3BhdGhdOyB9XG4gICAgaWYgKHBhdGggPT0gbnVsbCB8fCBwYXRoPy5sZW5ndGggPCAxKSB7IHJldHVybiBvYmo7IH1cblxuICAgIC8vIGlmIGRlc2NyaXB0b3IgZXhpc3RzLCB1bndyYXAgaXQuLi5cbiAgICBjb25zdCAkZGVzYyA9IG9iaj8uWyRkZXNjcmlwdG9yXSA/PyAob2JqPy4kaXNEZXNjcmlwdG9yID8gb2JqIDogbnVsbCk7XG4gICAgaWYgKCRkZXNjICYmICRkZXNjPy5vd25lciA9PSBTRUxGX0NIQU5ORUw/Lm5hbWUpIHtcbiAgICAgICAgb2JqID0gcmVhZEJ5UGF0aCgkZGVzYz8ucGF0aCkgPz8gb2JqO1xuICAgIH1cblxuICAgIGlmIChpc1ByaW1pdGl2ZShvYmopKSB7IHJldHVybiBvYmo7IH1cbiAgICBmb3IgKGNvbnN0IGtleSBvZiBwYXRoKSB7IG9iaiA9IG9iaj8uW2tleV07IGlmIChvYmogPT0gbnVsbCkgeyByZXR1cm4gb2JqOyB9IH1cbiAgICByZXR1cm4gb2JqO1xufVxuXG4vLyBUT0RPOiBhc3luYyBzdXBwb3J0XG5leHBvcnQgY29uc3QgcmVhZEJ5UGF0aCA9IChwYXRoOiBzdHJpbmdbXSkgPT4ge1xuICAgIGlmIChwYXRoICE9IG51bGwgJiYgIUFycmF5LmlzQXJyYXkocGF0aCkpIHsgcGF0aCA9IFtwYXRoXTsgfVxuICAgIGlmIChwYXRoID09IG51bGwgfHwgcGF0aD8ubGVuZ3RoIDwgMSkgeyByZXR1cm4gbnVsbDsgfVxuICAgIGNvbnN0IHJvb3QgPSBzdG9yZWREYXRhPy5nZXQ/LihwYXRoPy5bMF0pID8/IG51bGw7XG4gICAgcmV0dXJuIHJvb3QgIT0gbnVsbCA/IHRyYXZlcnNlQnlQYXRoKHJvb3QsIHBhdGg/LnNsaWNlPy4oMSkpIDogbnVsbDtcbn1cblxuLy8gVE9ETzogYXN5bmMgc3VwcG9ydFxuZXhwb3J0IGNvbnN0IHdyaXRlQnlQYXRoID0gKHBhdGg6IHN0cmluZ1tdLCBkYXRhOiBhbnkpID0+IHtcbiAgICAvLyBpZiBkZXNjcmlwdG9yIGV4aXN0cywgdW53cmFwIGl0Li4uXG4gICAgY29uc3QgJGRlc2MgPSBkYXRhPy5bJGRlc2NyaXB0b3JdID8/IChkYXRhPy4kaXNEZXNjcmlwdG9yID8gZGF0YSA6IG51bGwpO1xuICAgIGlmICgkZGVzYyAmJiAkZGVzYz8ub3duZXIgPT0gU0VMRl9DSEFOTkVMPy5uYW1lKSB7XG4gICAgICAgIGRhdGEgPSByZWFkQnlQYXRoKCRkZXNjPy5wYXRoKSA/PyBkYXRhO1xuICAgIH1cblxuICAgIC8vXG4gICAgaWYgKHBhdGggIT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShwYXRoKSkgeyBwYXRoID0gW3BhdGhdOyB9XG4gICAgaWYgKHBhdGggPT0gbnVsbCB8fCBwYXRoPy5sZW5ndGggPCAxKSB7IHJldHVybiBudWxsOyB9XG4gICAgY29uc3Qgcm9vdCA9IHN0b3JlZERhdGE/LmdldD8uKHBhdGg/LlswXSkgPz8gbnVsbDtcbiAgICBpZiAocGF0aD8ubGVuZ3RoID4gMSkgeyB0cmF2ZXJzZUJ5UGF0aChyb290LCBwYXRoPy5zbGljZT8uKDEsIC0xKSlbcGF0aD8uW3BhdGg/Lmxlbmd0aCAtIDFdXSA9IGRhdGE7IH0gZWxzZSB7IHN0b3JlZERhdGE/LnNldD8uKHBhdGg/LlswXSwgZGF0YSk7IH1cbiAgICBpZiAodHlwZW9mIGRhdGEgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgZGF0YSA9PSBcImZ1bmN0aW9uXCIpIHsgcmVnaXN0ZXJlZEluUGF0aD8uc2V0Py4oZGF0YSwgcGF0aCk7IH1cbiAgICByZXR1cm4gZGF0YTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCByZW1vdmVCeVBhdGggPSAocGF0aDogc3RyaW5nW10pID0+IHtcbiAgICBpZiAocGF0aCAhPSBudWxsICYmICFBcnJheS5pc0FycmF5KHBhdGgpKSB7IHBhdGggPSBbcGF0aF07IH1cbiAgICBpZiAocGF0aCA9PSBudWxsIHx8IHBhdGg/Lmxlbmd0aCA8IDEpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgY29uc3Qgcm9vdCA9IHN0b3JlZERhdGE/LmdldD8uKHBhdGg/LlswXSkgPz8gbnVsbDtcbiAgICBpZiAoIXJvb3QgJiYgcGF0aD8ubGVuZ3RoIDw9IDEpIHsgc3RvcmVkRGF0YT8uZGVsZXRlPy4ocGF0aD8uWzBdKTsgcmV0dXJuIHRydWU7IH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGRlbGV0ZSB0cmF2ZXJzZUJ5UGF0aChyb290LCBwYXRoPy5zbGljZT8uKDEsIC0xKSlbcGF0aD8uW3BhdGg/Lmxlbmd0aCAtIDFdXTtcbiAgICBpZiAoKHR5cGVvZiByb290ID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHJvb3QgPT0gXCJmdW5jdGlvblwiKSAmJiBwYXRoPy5sZW5ndGggPD0gMSkgeyByZWdpc3RlcmVkSW5QYXRoPy5kZWxldGU/Lihyb290KTsgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IHJlbW92ZUJ5RGF0YSA9IChkYXRhOiBhbnkpID0+IHtcbiAgICAvLyBpZiBkZXNjcmlwdG9yIGV4aXN0cywgdW53cmFwIGl0Li4uXG4gICAgY29uc3QgJGRlc2MgPSBkYXRhPy5bJGRlc2NyaXB0b3JdID8/IChkYXRhPy4kaXNEZXNjcmlwdG9yID8gZGF0YSA6IG51bGwpO1xuICAgIGlmICgkZGVzYyAmJiAkZGVzYz8ub3duZXIgPT0gU0VMRl9DSEFOTkVMPy5uYW1lKSB7XG4gICAgICAgIGRhdGEgPSByZWFkQnlQYXRoKCRkZXNjPy5wYXRoKSA/PyBkYXRhO1xuICAgIH1cblxuICAgIC8vXG4gICAgY29uc3QgcGF0aCA9IHJlZ2lzdGVyZWRJblBhdGg/LmdldD8uKGRhdGEpID8/ICRkZXNjPy5wYXRoO1xuICAgIGlmIChwYXRoID09IG51bGwgfHwgcGF0aD8ubGVuZ3RoIDwgMSkgeyByZXR1cm4gZmFsc2U7IH07IHJlbW92ZUJ5UGF0aChwYXRoKTtcbiAgICBpZiAodHlwZW9mIGRhdGEgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgZGF0YSA9PSBcImZ1bmN0aW9uXCIpIHsgcmVnaXN0ZXJlZEluUGF0aD8uZGVsZXRlPy4oZGF0YSk7IH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBoYXNOb1BhdGggPSAoZGF0YTogYW55KSA9PiB7XG4gICAgY29uc3QgJGRlc2MgPSBkYXRhPy5bJGRlc2NyaXB0b3JdID8/IChkYXRhPy4kaXNEZXNjcmlwdG9yID8gZGF0YSA6IG51bGwpO1xuICAgIHJldHVybiAocmVnaXN0ZXJlZEluUGF0aD8uZ2V0Py4oZGF0YSkgPz8gJGRlc2M/LnBhdGgpID09IG51bGw7XG59XG4iXX0=