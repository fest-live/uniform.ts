/**
 * Chrome Extension Observable API
 *
 * Observable wrappers for Chrome Extension messaging.
 */
import { UUIDv4 } from "fest/core";
// ============================================================================
// BASE CHROME OBSERVABLE
// ============================================================================
class BaseChromeObservable {
    _subs = new Set();
    _listening = false;
    _cleanup = null;
    subscribe(observer) {
        const obs = typeof observer === "function" ? { next: observer } : observer;
        const first = this._subs.size === 0;
        this._subs.add(obs);
        if (first && !this._listening)
            this._activate();
        return {
            closed: false,
            unsubscribe: () => {
                this._subs.delete(obs);
                if (this._subs.size === 0 && this._listening)
                    this._deactivate();
            }
        };
    }
    _deactivate() { this._cleanup?.(); this._cleanup = null; this._listening = false; }
    _dispatch(value) {
        for (const s of this._subs) {
            try {
                s.next?.(value);
            }
            catch (e) {
                s.error?.(e);
            }
        }
    }
    close() { this._subs.forEach((s) => s.complete?.()); this._subs.clear(); this._deactivate(); }
}
// ============================================================================
// CHROME RUNTIME OBSERVABLE
// ============================================================================
export class ChromeRuntimeObservable extends BaseChromeObservable {
    _handler;
    _options;
    _pending = new Map();
    constructor(_handler, _options = {}) {
        super();
        this._handler = _handler;
        this._options = _options;
    }
    send(msg) {
        if (typeof chrome === "undefined" || !chrome.runtime)
            return;
        const { _sender, _tabId, _frameId, transferable, ...data } = msg;
        chrome.runtime.sendMessage(data);
    }
    request(msg) {
        const reqId = msg.reqId ?? UUIDv4();
        return new Promise((resolve, reject) => {
            this._pending.set(reqId, { resolve, reject, timestamp: Date.now() });
            const { _sender, _tabId, _frameId, transferable, ...data } = { ...msg, reqId };
            chrome.runtime.sendMessage(data, (response) => {
                if (chrome.runtime.lastError)
                    reject(new Error(chrome.runtime.lastError.message));
                else
                    resolve(response);
                this._pending.delete(reqId);
            });
        });
    }
    _activate() {
        if (this._listening || typeof chrome === "undefined" || !chrome.runtime)
            return;
        const listener = (message, sender, sendResponse) => {
            if (this._options.filterSender && !this._options.filterSender(sender))
                return false;
            if (this._options.filterMessage && !this._options.filterMessage(message))
                return false;
            const data = {
                ...message, id: message.id ?? UUIDv4(),
                _sender: sender, _tabId: sender.tab?.id, _frameId: sender.frameId
            };
            // Handle response
            if (data.type === "response" && data.reqId) {
                const p = this._pending.get(data.reqId);
                if (p) {
                    p.resolve(data.payload);
                    this._pending.delete(data.reqId);
                }
            }
            if (this._handler) {
                const respond = (result) => sendResponse(result);
                const subscriber = {
                    next: (v) => this._dispatch(v), error: () => { }, complete: () => { },
                    signal: new AbortController().signal, active: true
                };
                const result = this._handler(data, respond, subscriber);
                return result instanceof Promise ? true : this._options.asyncResponse;
            }
            this._dispatch(data);
            return false;
        };
        chrome.runtime.onMessage.addListener(listener);
        this._cleanup = () => chrome.runtime.onMessage.removeListener(listener);
        this._listening = true;
    }
}
// ============================================================================
// CHROME TABS OBSERVABLE
// ============================================================================
export class ChromeTabsObservable extends BaseChromeObservable {
    _tabId;
    _options;
    constructor(_tabId, _options = {}) {
        super();
        this._tabId = _tabId;
        this._options = _options;
    }
    setTabId(id) { this._tabId = id; }
    send(msg) {
        if (typeof chrome === "undefined" || !chrome.tabs || this._tabId == null)
            return;
        const { _sender, _tabId, _frameId, transferable, ...data } = msg;
        chrome.tabs.sendMessage(this._tabId, data);
    }
    _activate() {
        if (this._listening || typeof chrome === "undefined" || !chrome.runtime)
            return;
        const listener = (message, sender) => {
            if (this._tabId != null && sender.tab?.id !== this._tabId)
                return;
            if (this._options.filterSender && !this._options.filterSender(sender))
                return;
            const data = {
                ...message, id: message.id ?? UUIDv4(),
                _sender: sender, _tabId: sender.tab?.id, _frameId: sender.frameId
            };
            this._dispatch(data);
        };
        chrome.runtime.onMessage.addListener(listener);
        this._cleanup = () => chrome.runtime.onMessage.removeListener(listener);
        this._listening = true;
    }
}
// ============================================================================
// CHROME PORT OBSERVABLE
// ============================================================================
export class ChromePortObservable extends BaseChromeObservable {
    _portName;
    _tabId;
    _port = null;
    _info = null;
    constructor(_portName, _tabId) {
        super();
        this._portName = _portName;
        this._tabId = _tabId;
    }
    connect() {
        if (typeof chrome === "undefined" || !chrome.runtime)
            return;
        this._port = this._tabId != null
            ? chrome.tabs.connect(this._tabId, { name: this._portName })
            : chrome.runtime.connect({ name: this._portName });
        this._info = { name: this._portName, tabId: this._tabId };
        this._setupListeners();
    }
    send(msg) {
        if (!this._port)
            return;
        const { _sender, _tabId, _frameId, transferable, ...data } = msg;
        this._port.postMessage(data);
    }
    _setupListeners() {
        if (!this._port)
            return;
        this._port.onMessage.addListener((msg) => this._dispatch({ ...msg, id: msg.id ?? UUIDv4() }));
        this._port.onDisconnect.addListener(() => { this._subs.forEach((s) => s.complete?.()); this._port = null; });
    }
    _activate() { if (!this._port)
        this.connect(); this._listening = true; }
    _deactivate() { this._port?.disconnect(); this._port = null; super._deactivate(); }
    get portInfo() { return this._info; }
    get isConnected() { return this._port != null; }
}
// ============================================================================
// CHROME EXTERNAL OBSERVABLE
// ============================================================================
export class ChromeExternalObservable extends BaseChromeObservable {
    _extensionId;
    constructor(_extensionId) {
        super();
        this._extensionId = _extensionId;
    }
    send(msg) {
        if (typeof chrome === "undefined" || !chrome.runtime)
            return;
        const { _sender, _tabId, _frameId, transferable, ...data } = msg;
        if (this._extensionId)
            chrome.runtime.sendMessage(this._extensionId, data);
        else
            chrome.runtime.sendMessage(data);
    }
    _activate() {
        if (this._listening || typeof chrome === "undefined" || !chrome.runtime?.onMessageExternal)
            return;
        const listener = (message, sender) => {
            this._dispatch({ ...message, id: message.id ?? UUIDv4(), _sender: sender });
        };
        chrome.runtime.onMessageExternal.addListener(listener);
        this._cleanup = () => chrome.runtime.onMessageExternal.removeListener(listener);
        this._listening = true;
    }
}
// ============================================================================
// REQUEST HANDLER
// ============================================================================
export function createChromeRequestHandler(channelName, handlers) {
    return async (data, respond, subscriber) => {
        if (data.type !== "request") {
            subscriber.next(data);
            return;
        }
        const action = data.payload?.action;
        if (action && handlers[action]) {
            try {
                const result = await handlers[action](data.payload?.args ?? [], data);
                respond({ id: UUIDv4(), channel: data.sender, sender: channelName, reqId: data.reqId, type: "response", payload: { result }, timestamp: Date.now() });
            }
            catch (error) {
                respond({ id: UUIDv4(), channel: data.sender, sender: channelName, reqId: data.reqId, type: "response", payload: { error: error instanceof Error ? error.message : String(error) }, timestamp: Date.now() });
            }
        }
        else {
            subscriber.next(data);
        }
    };
}
// ============================================================================
// FACTORY
// ============================================================================
export const ChromeObservableFactory = {
    runtime: (handler, options) => new ChromeRuntimeObservable(handler, options),
    tabs: (tabId, options) => new ChromeTabsObservable(tabId, options),
    port: (name, tabId) => new ChromePortObservable(name, tabId),
    external: (extensionId) => new ChromeExternalObservable(extensionId)
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2hyb21lT2JzZXJ2YWJsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNocm9tZU9ic2VydmFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUEyQm5DLCtFQUErRTtBQUMvRSx5QkFBeUI7QUFDekIsK0VBQStFO0FBRS9FLE1BQWUsb0JBQW9CO0lBQ3JCLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBZSxDQUFDO0lBQy9CLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDbkIsUUFBUSxHQUF3QixJQUFJLENBQUM7SUFJL0MsU0FBUyxDQUFDLFFBQXdDO1FBQzlDLE1BQU0sR0FBRyxHQUFnQixPQUFPLFFBQVEsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFDeEYsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVU7WUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDaEQsT0FBTztZQUNILE1BQU0sRUFBRSxLQUFLO1lBQ2IsV0FBVyxFQUFFLEdBQUcsRUFBRTtnQkFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVU7b0JBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3JFLENBQUM7U0FDSixDQUFDO0lBQ04sQ0FBQztJQUdTLFdBQVcsS0FBVyxJQUFJLENBQUMsUUFBUSxFQUFFLEVB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c0NvbnRlbnQiOlsiLyoqXG4gKiBDaHJvbWUgRXh0ZW5zaW9uIE9ic2VydmFibGUgQVBJXG4gKlxuICogT2JzZXJ2YWJsZSB3cmFwcGVycyBmb3IgQ2hyb21lIEV4dGVuc2lvbiBtZXNzYWdpbmcuXG4gKi9cblxuaW1wb3J0IHsgVVVJRHY0IH0gZnJvbSBcImZlc3QvY29yZVwiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQ2hhbm5lbFN1YmplY3QsIHR5cGUgU3Vic2NyaXB0aW9uLCB0eXBlIE9ic2VydmVyIH0gZnJvbSBcIi4vT2JzZXJ2YWJsZVwiO1xuaW1wb3J0IHR5cGUgeyBDaGFubmVsTWVzc2FnZSwgSW52b2tlckhhbmRsZXIsIFJlc3BvbmRlckZuLCBTdWJzY3JpYmVyLCBQZW5kaW5nUmVxdWVzdCB9IGZyb20gXCIuLi90eXBlcy9JbnRlcmZhY2VcIjtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVFlQRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDaHJvbWVNZXNzYWdlPFQgPSBhbnk+IGV4dGVuZHMgQ2hhbm5lbE1lc3NhZ2Uge1xuICAgIF9zZW5kZXI/OiBjaHJvbWUucnVudGltZS5NZXNzYWdlU2VuZGVyO1xuICAgIF90YWJJZD86IG51bWJlcjtcbiAgICBfZnJhbWVJZD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb3J0SW5mbyB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHRhYklkPzogbnVtYmVyO1xuICAgIGZyYW1lSWQ/OiBudW1iZXI7XG4gICAgdXJsPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENocm9tZU9ic2VydmFibGVPcHRpb25zIHtcbiAgICBmaWx0ZXJTZW5kZXI/OiAoc2VuZGVyOiBjaHJvbWUucnVudGltZS5NZXNzYWdlU2VuZGVyKSA9PiBib29sZWFuO1xuICAgIGZpbHRlck1lc3NhZ2U/OiAobWVzc2FnZTogYW55KSA9PiBib29sZWFuO1xuICAgIGFzeW5jUmVzcG9uc2U/OiBib29sZWFuO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBCQVNFIENIUk9NRSBPQlNFUlZBQkxFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmFic3RyYWN0IGNsYXNzIEJhc2VDaHJvbWVPYnNlcnZhYmxlPFQgPSBDaHJvbWVNZXNzYWdlPiB7XG4gICAgcHJvdGVjdGVkIF9zdWJzID0gbmV3IFNldDxPYnNlcnZlcjxUPj4oKTtcbiAgICBwcm90ZWN0ZWQgX2xpc3RlbmluZyA9IGZhbHNlO1xuICAgIHByb3RlY3RlZCBfY2xlYW51cDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG5cbiAgICBhYnN0cmFjdCBzZW5kKG1zZzogVCk6IHZvaWQ7XG5cbiAgICBzdWJzY3JpYmUob2JzZXJ2ZXI6IE9ic2VydmVyPFQ+IHwgKCh2OiBUKSA9PiB2b2lkKSk6IFN1YnNjcmlwdGlvbiB7XG4gICAgICAgIGNvbnN0IG9iczogT2JzZXJ2ZXI8VD4gPSB0eXBlb2Ygb2JzZXJ2ZXIgPT09IFwiZnVuY3Rpb25cIiA/IHsgbmV4dDogb2JzZXJ2ZXIgfSA6IG9ic2VydmVyO1xuICAgICAgICBjb25zdCBmaXJzdCA9IHRoaXMuX3N1YnMuc2l6ZSA9PT0gMDtcbiAgICAgICAgdGhpcy5fc3Vicy5hZGQob2JzKTtcbiAgICAgICAgaWYgKGZpcnN0ICYmICF0aGlzLl9saXN0ZW5pbmcpIHRoaXMuX2FjdGl2YXRlKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjbG9zZWQ6IGZhbHNlLFxuICAgICAgICAgICAgdW5zdWJzY3JpYmU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzLmRlbGV0ZShvYnMpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdWJzLnNpemUgPT09IDAgJiYgdGhpcy5fbGlzdGVuaW5nKSB0aGlzLl9kZWFjdGl2YXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IF9hY3RpdmF0ZSgpOiB2b2lkO1xuICAgIHByb3RlY3RlZCBfZGVhY3RpdmF0ZSgpOiB2b2lkIHsgdGhpcy5fY2xlYW51cD8uKCk7IHRoaXMuX2NsZWFudXAgPSBudWxsOyB0aGlzLl9saXN0ZW5pbmcgPSBmYWxzZTsgfVxuXG4gICAgcHJvdGVjdGVkIF9kaXNwYXRjaCh2YWx1ZTogVCk6IHZvaWQge1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5fc3VicykgeyB0cnkgeyBzLm5leHQ/Lih2YWx1ZSk7IH0gY2F0Y2ggKGUpIHsgcy5lcnJvcj8uKGUgYXMgRXJyb3IpOyB9IH1cbiAgICB9XG5cbiAgICBjbG9zZSgpOiB2b2lkIHsgdGhpcy5fc3Vicy5mb3JFYWNoKChzKSA9PiBzLmNvbXBsZXRlPy4oKSk7IHRoaXMuX3N1YnMuY2xlYXIoKTsgdGhpcy5fZGVhY3RpdmF0ZSgpOyB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENIUk9NRSBSVU5USU1FIE9CU0VSVkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNsYXNzIENocm9tZVJ1bnRpbWVPYnNlcnZhYmxlIGV4dGVuZHMgQmFzZUNocm9tZU9ic2VydmFibGU8Q2hyb21lTWVzc2FnZT4ge1xuICAgIHByaXZhdGUgX3BlbmRpbmcgPSBuZXcgTWFwPHN0cmluZywgUGVuZGluZ1JlcXVlc3Q+KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBfaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENocm9tZU1lc3NhZ2U+LFxuICAgICAgICBwcml2YXRlIF9vcHRpb25zOiBDaHJvbWVPYnNlcnZhYmxlT3B0aW9ucyA9IHt9XG4gICAgKSB7IHN1cGVyKCk7IH1cblxuICAgIHNlbmQobXNnOiBDaHJvbWVNZXNzYWdlKTogdm9pZCB7XG4gICAgICAgIGlmICh0eXBlb2YgY2hyb21lID09PSBcInVuZGVmaW5lZFwiIHx8ICFjaHJvbWUucnVudGltZSkgcmV0dXJuO1xuICAgICAgICBjb25zdCB7IF9zZW5kZXIsIF90YWJJZCwgX2ZyYW1lSWQsIHRyYW5zZmVyYWJsZSwgLi4uZGF0YSB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UoZGF0YSk7XG4gICAgfVxuXG4gICAgcmVxdWVzdChtc2c6IENocm9tZU1lc3NhZ2UpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCByZXFJZCA9IG1zZy5yZXFJZCA/PyBVVUlEdjQoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3BlbmRpbmcuc2V0KHJlcUlkLCB7IHJlc29sdmUsIHJlamVjdCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICAgICAgICAgICAgY29uc3QgeyBfc2VuZGVyLCBfdGFiSWQsIF9mcmFtZUlkLCB0cmFuc2ZlcmFibGUsIC4uLmRhdGEgfSA9IHsgLi4ubXNnLCByZXFJZCB9IGFzIGFueTtcbiAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKGRhdGEsIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpIHJlamVjdChuZXcgRXJyb3IoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yLm1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgICBlbHNlIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmcuZGVsZXRlKHJlcUlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2FjdGl2YXRlKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5fbGlzdGVuaW5nIHx8IHR5cGVvZiBjaHJvbWUgPT09IFwidW5kZWZpbmVkXCIgfHwgIWNocm9tZS5ydW50aW1lKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSAobWVzc2FnZTogYW55LCBzZW5kZXI6IGNocm9tZS5ydW50aW1lLk1lc3NhZ2VTZW5kZXIsIHNlbmRSZXNwb25zZTogKHI/OiBhbnkpID0+IHZvaWQpOiBib29sZWFuIHwgdm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5maWx0ZXJTZW5kZXIgJiYgIXRoaXMuX29wdGlvbnMuZmlsdGVyU2VuZGVyKHNlbmRlcikpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9vcHRpb25zLmZpbHRlck1lc3NhZ2UgJiYgIXRoaXMuX29wdGlvbnMuZmlsdGVyTWVzc2FnZShtZXNzYWdlKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICBjb25zdCBkYXRhOiBDaHJvbWVNZXNzYWdlID0ge1xuICAgICAgICAgICAgICAgIC4uLm1lc3NhZ2UsIGlkOiBtZXNzYWdlLmlkID8/IFVVSUR2NCgpLFxuICAgICAgICAgICAgICAgIF9zZW5kZXI6IHNlbmRlciwgX3RhYklkOiBzZW5kZXIudGFiPy5pZCwgX2ZyYW1lSWQ6IHNlbmRlci5mcmFtZUlkXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBIYW5kbGUgcmVzcG9uc2VcbiAgICAgICAgICAgIGlmIChkYXRhLnR5cGUgPT09IFwicmVzcG9uc2VcIiAmJiBkYXRhLnJlcUlkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuX3BlbmRpbmcuZ2V0KGRhdGEucmVxSWQpO1xuICAgICAgICAgICAgICAgIGlmIChwKSB7IHAucmVzb2x2ZShkYXRhLnBheWxvYWQpOyB0aGlzLl9wZW5kaW5nLmRlbGV0ZShkYXRhLnJlcUlkKTsgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5faGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbmQ6IFJlc3BvbmRlckZuPENocm9tZU1lc3NhZ2U+ID0gKHJlc3VsdCkgPT4gc2VuZFJlc3BvbnNlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxDaHJvbWVNZXNzYWdlPiA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dDogKHYpID0+IHRoaXMuX2Rpc3BhdGNoKHYpLCBlcnJvcjogKCkgPT4ge30sIGNvbXBsZXRlOiAoKSA9PiB7fSxcbiAgICAgICAgICAgICAgICAgICAgc2lnbmFsOiBuZXcgQWJvcnRDb250cm9sbGVyKCkuc2lnbmFsLCBhY3RpdmU6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2hhbmRsZXIoZGF0YSwgcmVzcG9uZCwgc3Vic2NyaWJlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCBpbnN0YW5jZW9mIFByb21pc2UgPyB0cnVlIDogdGhpcy5fb3B0aW9ucy5hc3luY1Jlc3BvbnNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9kaXNwYXRjaChkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIobGlzdGVuZXIpO1xuICAgICAgICB0aGlzLl9jbGVhbnVwID0gKCkgPT4gY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fbGlzdGVuaW5nID0gdHJ1ZTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENIUk9NRSBUQUJTIE9CU0VSVkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNsYXNzIENocm9tZVRhYnNPYnNlcnZhYmxlIGV4dGVuZHMgQmFzZUNocm9tZU9ic2VydmFibGU8Q2hyb21lTWVzc2FnZT4ge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3RhYklkPzogbnVtYmVyLCBwcml2YXRlIF9vcHRpb25zOiBDaHJvbWVPYnNlcnZhYmxlT3B0aW9ucyA9IHt9KSB7IHN1cGVyKCk7IH1cblxuICAgIHNldFRhYklkKGlkOiBudW1iZXIpOiB2b2lkIHsgdGhpcy5fdGFiSWQgPSBpZDsgfVxuXG4gICAgc2VuZChtc2c6IENocm9tZU1lc3NhZ2UpOiB2b2lkIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjaHJvbWUgPT09IFwidW5kZWZpbmVkXCIgfHwgIWNocm9tZS50YWJzIHx8IHRoaXMuX3RhYklkID09IG51bGwpIHJldHVybjtcbiAgICAgICAgY29uc3QgeyBfc2VuZGVyLCBfdGFiSWQsIF9mcmFtZUlkLCB0cmFuc2ZlcmFibGUsIC4uLmRhdGEgfSA9IG1zZyBhcyBhbnk7XG4gICAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRoaXMuX3RhYklkLCBkYXRhKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2FjdGl2YXRlKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5fbGlzdGVuaW5nIHx8IHR5cGVvZiBjaHJvbWUgPT09IFwidW5kZWZpbmVkXCIgfHwgIWNocm9tZS5ydW50aW1lKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSAobWVzc2FnZTogYW55LCBzZW5kZXI6IGNocm9tZS5ydW50aW1lLk1lc3NhZ2VTZW5kZXIpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLl90YWJJZCAhPSBudWxsICYmIHNlbmRlci50YWI/LmlkICE9PSB0aGlzLl90YWJJZCkgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMuZmlsdGVyU2VuZGVyICYmICF0aGlzLl9vcHRpb25zLmZpbHRlclNlbmRlcihzZW5kZXIpKSByZXR1cm47XG5cbiAgICAgICAgICAgIGNvbnN0IGRhdGE6IENocm9tZU1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgLi4ubWVzc2FnZSwgaWQ6IG1lc3NhZ2UuaWQgPz8gVVVJRHY0KCksXG4gICAgICAgICAgICAgICAgX3NlbmRlcjogc2VuZGVyLCBfdGFiSWQ6IHNlbmRlci50YWI/LmlkLCBfZnJhbWVJZDogc2VuZGVyLmZyYW1lSWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLl9kaXNwYXRjaChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIobGlzdGVuZXIpO1xuICAgICAgICB0aGlzLl9jbGVhbnVwID0gKCkgPT4gY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fbGlzdGVuaW5nID0gdHJ1ZTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENIUk9NRSBQT1JUIE9CU0VSVkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNsYXNzIENocm9tZVBvcnRPYnNlcnZhYmxlIGV4dGVuZHMgQmFzZUNocm9tZU9ic2VydmFibGU8Q2hyb21lTWVzc2FnZT4ge1xuICAgIHByaXZhdGUgX3BvcnQ6IGNocm9tZS5ydW50aW1lLlBvcnQgfCBudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIF9pbmZvOiBQb3J0SW5mbyB8IG51bGwgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfcG9ydE5hbWU6IHN0cmluZywgcHJpdmF0ZSBfdGFiSWQ/OiBudW1iZXIpIHsgc3VwZXIoKTsgfVxuXG4gICAgY29ubmVjdCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjaHJvbWUgPT09IFwidW5kZWZpbmVkXCIgfHwgIWNocm9tZS5ydW50aW1lKSByZXR1cm47XG4gICAgICAgIHRoaXMuX3BvcnQgPSB0aGlzLl90YWJJZCAhPSBudWxsXG4gICAgICAgICAgICA/IGNocm9tZS50YWJzLmNvbm5lY3QodGhpcy5fdGFiSWQsIHsgbmFtZTogdGhpcy5fcG9ydE5hbWUgfSlcbiAgICAgICAgICAgIDogY2hyb21lLnJ1bnRpbWUuY29ubmVjdCh7IG5hbWU6IHRoaXMuX3BvcnROYW1lIH0pO1xuXG4gICAgICAgIHRoaXMuX2luZm8gPSB7IG5hbWU6IHRoaXMuX3BvcnROYW1lLCB0YWJJZDogdGhpcy5fdGFiSWQgfTtcbiAgICAgICAgdGhpcy5fc2V0dXBMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBzZW5kKG1zZzogQ2hyb21lTWVzc2FnZSk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuX3BvcnQpIHJldHVybjtcbiAgICAgICAgY29uc3QgeyBfc2VuZGVyLCBfdGFiSWQsIF9mcmFtZUlkLCB0cmFuc2ZlcmFibGUsIC4uLmRhdGEgfSA9IG1zZyBhcyBhbnk7XG4gICAgICAgIHRoaXMuX3BvcnQucG9zdE1lc3NhZ2UoZGF0YSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc2V0dXBMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5fcG9ydCkgcmV0dXJuO1xuICAgICAgICB0aGlzLl9wb3J0Lm9uTWVzc2FnZS5hZGRMaXN0ZW5lcigobXNnKSA9PiB0aGlzLl9kaXNwYXRjaCh7IC4uLm1zZywgaWQ6IG1zZy5pZCA/PyBVVUlEdjQoKSB9KSk7XG4gICAgICAgIHRoaXMuX3BvcnQub25EaXNjb25uZWN0LmFkZExpc3RlbmVyKCgpID0+IHsgdGhpcy5fc3Vicy5mb3JFYWNoKChzKSA9PiBzLmNvbXBsZXRlPy4oKSk7IHRoaXMuX3BvcnQgPSBudWxsOyB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2FjdGl2YXRlKCk6IHZvaWQgeyBpZiAoIXRoaXMuX3BvcnQpIHRoaXMuY29ubmVjdCgpOyB0aGlzLl9saXN0ZW5pbmcgPSB0cnVlOyB9XG4gICAgcHJvdGVjdGVkIF9kZWFjdGl2YXRlKCk6IHZvaWQgeyB0aGlzLl9wb3J0Py5kaXNjb25uZWN0KCk7IHRoaXMuX3BvcnQgPSBudWxsOyBzdXBlci5fZGVhY3RpdmF0ZSgpOyB9XG5cbiAgICBnZXQgcG9ydEluZm8oKTogUG9ydEluZm8gfCBudWxsIHsgcmV0dXJuIHRoaXMuX2luZm87IH1cbiAgICBnZXQgaXNDb25uZWN0ZWQoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLl9wb3J0ICE9IG51bGw7IH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ0hST01FIEVYVEVSTkFMIE9CU0VSVkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNsYXNzIENocm9tZUV4dGVybmFsT2JzZXJ2YWJsZSBleHRlbmRzIEJhc2VDaHJvbWVPYnNlcnZhYmxlPENocm9tZU1lc3NhZ2U+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9leHRlbnNpb25JZD86IHN0cmluZykgeyBzdXBlcigpOyB9XG5cbiAgICBzZW5kKG1zZzogQ2hyb21lTWVzc2FnZSk6IHZvaWQge1xuICAgICAgICBpZiAodHlwZW9mIGNocm9tZSA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhY2hyb21lLnJ1bnRpbWUpIHJldHVybjtcbiAgICAgICAgY29uc3QgeyBfc2VuZGVyLCBfdGFiSWQsIF9mcmFtZUlkLCB0cmFuc2ZlcmFibGUsIC4uLmRhdGEgfSA9IG1zZyBhcyBhbnk7XG4gICAgICAgIGlmICh0aGlzLl9leHRlbnNpb25JZCkgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UodGhpcy5fZXh0ZW5zaW9uSWQsIGRhdGEpO1xuICAgICAgICBlbHNlIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKGRhdGEpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfYWN0aXZhdGUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9saXN0ZW5pbmcgfHwgdHlwZW9mIGNocm9tZSA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhY2hyb21lLnJ1bnRpbWU/Lm9uTWVzc2FnZUV4dGVybmFsKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSAobWVzc2FnZTogYW55LCBzZW5kZXI6IGNocm9tZS5ydW50aW1lLk1lc3NhZ2VTZW5kZXIpOiB2b2lkID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoKHsgLi4ubWVzc2FnZSwgaWQ6IG1lc3NhZ2UuaWQgPz8gVVVJRHY0KCksIF9zZW5kZXI6IHNlbmRlciB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2VFeHRlcm5hbC5hZGRMaXN0ZW5lcihsaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX2NsZWFudXAgPSAoKSA9PiBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2VFeHRlcm5hbC5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX2xpc3RlbmluZyA9IHRydWU7XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBSRVFVRVNUIEhBTkRMRVJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNocm9tZVJlcXVlc3RIYW5kbGVyKFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcnM6IFJlY29yZDxzdHJpbmcsIChhcmdzOiBhbnlbXSwgZGF0YTogQ2hyb21lTWVzc2FnZSkgPT4gYW55IHwgUHJvbWlzZTxhbnk+PlxuKTogSW52b2tlckhhbmRsZXI8Q2hyb21lTWVzc2FnZT4ge1xuICAgIHJldHVybiBhc3luYyAoZGF0YSwgcmVzcG9uZCwgc3Vic2NyaWJlcikgPT4ge1xuICAgICAgICBpZiAoZGF0YS50eXBlICE9PSBcInJlcXVlc3RcIikgeyBzdWJzY3JpYmVyLm5leHQoZGF0YSk7IHJldHVybjsgfVxuICAgICAgICBjb25zdCBhY3Rpb24gPSBkYXRhLnBheWxvYWQ/LmFjdGlvbjtcbiAgICAgICAgaWYgKGFjdGlvbiAmJiBoYW5kbGVyc1thY3Rpb25dKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXJzW2FjdGlvbl0oZGF0YS5wYXlsb2FkPy5hcmdzID8/IFtdLCBkYXRhKTtcbiAgICAgICAgICAgICAgICByZXNwb25kKHsgaWQ6IFVVSUR2NCgpLCBjaGFubmVsOiBkYXRhLnNlbmRlciwgc2VuZGVyOiBjaGFubmVsTmFtZSwgcmVxSWQ6IGRhdGEucmVxSWQsIHR5cGU6IFwicmVzcG9uc2VcIiwgcGF5bG9hZDogeyByZXN1bHQgfSwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0gYXMgQ2hyb21lTWVzc2FnZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHJlc3BvbmQoeyBpZDogVVVJRHY0KCksIGNoYW5uZWw6IGRhdGEuc2VuZGVyLCBzZW5kZXI6IGNoYW5uZWxOYW1lLCByZXFJZDogZGF0YS5yZXFJZCwgdHlwZTogXCJyZXNwb25zZVwiLCBwYXlsb2FkOiB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcikgfSwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0gYXMgQ2hyb21lTWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdWJzY3JpYmVyLm5leHQoZGF0YSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGQUNUT1JZXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBDaHJvbWVPYnNlcnZhYmxlRmFjdG9yeSA9IHtcbiAgICBydW50aW1lOiAoaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENocm9tZU1lc3NhZ2U+LCBvcHRpb25zPzogQ2hyb21lT2JzZXJ2YWJsZU9wdGlvbnMpID0+IG5ldyBDaHJvbWVSdW50aW1lT2JzZXJ2YWJsZShoYW5kbGVyLCBvcHRpb25zKSxcbiAgICB0YWJzOiAodGFiSWQ/OiBudW1iZXIsIG9wdGlvbnM/OiBDaHJvbWVPYnNlcnZhYmxlT3B0aW9ucykgPT4gbmV3IENocm9tZVRhYnNPYnNlcnZhYmxlKHRhYklkLCBvcHRpb25zKSxcbiAgICBwb3J0OiAobmFtZTogc3RyaW5nLCB0YWJJZD86IG51bWJlcikgPT4gbmV3IENocm9tZVBvcnRPYnNlcnZhYmxlKG5hbWUsIHRhYklkKSxcbiAgICBleHRlcm5hbDogKGV4dGVuc2lvbklkPzogc3RyaW5nKSA9PiBuZXcgQ2hyb21lRXh0ZXJuYWxPYnNlcnZhYmxlKGV4dGVuc2lvbklkKVxufTtcbiJdfQ==