/**
 * Observable Core - Unified WICG-aligned Observable implementation
 *
 * Single source of truth for all Observable primitives.
 * Reference: https://github.com/WICG/observable
 */
import { UUIDv4 } from "fest/core";
import { createTransportSender, createTransportListener } from "../../core/TransportCore";
import { handleRequest } from "../../core/RequestHandler";
// ============================================================================
// BASE SUBSCRIPTION
// ============================================================================
class BaseSubscription {
    _unsubscribe;
    _closed = false;
    constructor(_unsubscribe) {
        this._unsubscribe = _unsubscribe;
    }
    get closed() { return this._closed; }
    unsubscribe() { if (!this._closed) {
        this._closed = true;
        this._unsubscribe();
    } }
}
// ============================================================================
// CORE OBSERVABLE (WICG-aligned)
// ============================================================================
/**
 * Core Observable with producer function
 */
export class Observable {
    _producer;
    constructor(_producer) {
        this._producer = _producer;
    }
    subscribe(observerOrNext, opts) {
        const observer = typeof observerOrNext === "function"
            ? { next: observerOrNext } : observerOrNext ?? {};
        const ctrl = new AbortController();
        opts?.signal?.addEventListener("abort", () => ctrl.abort());
        let active = true;
        let cleanup;
        const doCleanup = () => { active = false; ctrl.abort(); cleanup?.(); };
        const subscriber = {
            next: (v) => active && observer.next?.(v),
            error: (e) => { if (active) {
                observer.error?.(e);
                doCleanup();
            } },
            complete: () => { if (active) {
                observer.complete?.();
                doCleanup();
            } },
            signal: ctrl.signal,
            get active() { return active && !ctrl.signal.aborted; }
        };
        try {
            cleanup = this._producer(subscriber);
        }
        catch (e) {
            subscriber.error(e);
        }
        return new BaseSubscription(doCleanup);
    }
    pipe(...ops) {
        return ops.reduce((s, op) => op(s), this);
    }
}
/**
 * Subject - Observable that can be pushed to
 */
export class ChannelSubject {
    _subs = new Set();
    _buffer = [];
    _maxBuffer;
    _replay;
    constructor(options = {}) {
        this._maxBuffer = options.bufferSize ?? 0;
        this._replay = options.replayOnSubscribe ?? false;
    }
    next(value) {
        if (this._maxBuffer > 0) {
            this._buffer.push(value);
            if (this._buffer.length > this._maxBuffer)
                this._buffer.shift();
        }
        for (const s of this._subs) {
            try {
                s.next?.(value);
            }
            catch (e) {
                s.error?.(e);
            }
        }
    }
    error(err) { for (const s of this._subs)
        s.error?.(err); }
    complete() { for (const s of this._subs)
        s.complete?.(); this._subs.clear(); }
    subscribe(observerOrNext) {
        const obs = typeof observerOrNext === "function" ? { next: observerOrNext } : observerOrNext;
        this._subs.add(obs);
        if (this._replay) {
            for (const v of this._buffer) {
                try {
                    obs.next?.(v);
                }
                catch (e) {
                    obs.error?.(e);
                }
            }
        }
        return new BaseSubscription(() => { this._subs.delete(obs); });
    }
    getValue() { return this._buffer.at(-1); }
    getBuffer() { return [...this._buffer]; }
    get subscriberCount() { return this._subs.size; }
}
export class ReplayChannelSubject extends ChannelSubject {
    constructor(bufferSize = 1) { super({ bufferSize, replayOnSubscribe: true }); }
}
// ============================================================================
// CHANNEL OBSERVABLE (with transport + request/response)
// ============================================================================
/**
 * Channel Observable with bidirectional communication
 */
export class ChannelObservable {
    _transport;
    _channelName;
    _send;
    _pending = new Map();
    _subs = new Set();
    _cleanup = null;
    _listening = false;
    constructor(_transport, _channelName) {
        this._transport = _transport;
        this._channelName = _channelName;
        this._send = createTransportSender(_transport);
    }
    next(msg, transfer) { this._send(msg, transfer); }
    subscribe(observer) {
        const obs = typeof observer === "function" ? { next: observer } : observer;
        this._subs.add(obs);
        if (!this._listening)
            this._activate();
        return new BaseSubscription(() => {
            this._subs.delete(obs);
            if (this._subs.size === 0)
                this._deactivate();
        });
    }
    request(msg) {
        const reqId = msg.reqId ?? UUIDv4();
        return new Promise((resolve, reject) => {
            this._pending.set(reqId, { resolve, reject, timestamp: Date.now() });
            this.next({ ...msg, reqId });
        });
    }
    _handle(data) {
        if (data.type === "response" && data.reqId) {
            const p = this._pending.get(data.reqId);
            if (p) {
                p.resolve(data.payload);
                this._pending.delete(data.reqId);
            }
        }
        for (const s of this._subs) {
            try {
                s.next?.(data);
            }
            catch (e) {
                s.error?.(e);
            }
        }
    }
    _activate() {
        if (this._listening)
            return;
        this._cleanup = createTransportListener(this._transport, (d) => this._handle(d), (e) => this._subs.forEach((s) => s.error?.(e)), () => this._subs.forEach((s) => s.complete?.()));
        this._listening = true;
    }
    _deactivate() {
        this._cleanup?.();
        this._cleanup = null;
        this._listening = false;
    }
    close() { this._subs.forEach((s) => s.complete?.()); this._subs.clear(); this._deactivate(); }
    get channelName() { return this._channelName; }
    get isListening() { return this._listening; }
}
// ============================================================================
// INVOKER OBSERVABLE
// ============================================================================
export function createInvokerObservable(transport, channelName, handler) {
    const send = createTransportSender(transport);
    return new Observable((subscriber) => {
        const onMessage = (data) => {
            if (!subscriber.active)
                return;
            const respond = (result, transfer) => {
                send({ ...result, channel: data.sender, sender: channelName, type: "response", reqId: data.reqId }, transfer);
            };
            handler ? handler(data, respond, subscriber) : subscriber.next(data);
        };
        return createTransportListener(transport, onMessage, (e) => subscriber.error(e), () => subscriber.complete());
    });
}
export function createReflectHandler(channelName) {
    return async (data, respond, subscriber) => {
        if (data.type !== "request") {
            subscriber.next(data);
            return;
        }
        const result = await handleRequest(data.payload, data.reqId, channelName);
        if (result)
            respond(result.response, result.transfer);
        subscriber.next(data);
    };
}
// ============================================================================
// MESSAGE OBSERVABLE (filtered by type)
// ============================================================================
export class MessageObservable extends ChannelSubject {
    constructor(source, messageType) {
        super();
        source.subscribe({
            next: (msg) => { if (!messageType || msg.type === messageType)
                this.next(msg); },
            error: (e) => this.error(e),
            complete: () => this.complete()
        });
    }
}
// ============================================================================
// OPERATORS
// ============================================================================
export const filter = (pred) => (src) => new Observable((sub) => { const s = src.subscribe({ next: (v) => pred(v) && sub.next(v), error: (e) => sub.error(e), complete: () => sub.complete() }); return () => s.unsubscribe(); });
export const map = (fn) => (src) => new Observable((sub) => { const s = src.subscribe({ next: (v) => sub.next(fn(v)), error: (e) => sub.error(e), complete: () => sub.complete() }); return () => s.unsubscribe(); });
export const take = (n) => (src) => new Observable((sub) => { let c = 0; const s = src.subscribe({ next: (v) => { if (c++ < n) {
        sub.next(v);
        if (c >= n)
            sub.complete();
    } }, error: (e) => sub.error(e), complete: () => sub.complete() }); return () => s.unsubscribe(); });
export const takeUntil = (signal) => (src) => new Observable((sub) => { const ss = src.subscribe({ next: (v) => sub.next(v), error: (e) => sub.error(e), complete: () => sub.complete() }); const sig = signal.subscribe({ next: () => sub.complete() }); return () => { ss.unsubscribe(); sig.unsubscribe(); }; });
export const debounce = (ms) => (src) => new Observable((sub) => { let t; const s = src.subscribe({ next: (v) => { clearTimeout(t); t = setTimeout(() => sub.next(v), ms); }, error: (e) => sub.error(e), complete: () => sub.complete() }); return () => { clearTimeout(t); s.unsubscribe(); }; });
export const throttle = (ms) => (src) => new Observable((sub) => { let last = 0; const s = src.subscribe({ next: (v) => { const now = Date.now(); if (now - last >= ms) {
        last = now;
        sub.next(v);
    } }, error: (e) => sub.error(e), complete: () => sub.complete() }); return () => s.unsubscribe(); });
// ============================================================================
// UTILITIES
// ============================================================================
export const fromEvent = (target, event) => new Observable((sub) => { const h = (e) => sub.active && sub.next(e); target.addEventListener(event, h); return () => target.removeEventListener(event, h); });
export const fromPromise = (promise) => new Observable((sub) => { promise.then((v) => { sub.next(v); sub.complete(); }).catch((e) => sub.error(e)); });
export const delay = (value, ms) => new Observable((sub) => { const t = setTimeout(() => { sub.next(value); sub.complete(); }, ms); return () => clearTimeout(t); });
export const interval = (ms) => new Observable((sub) => { let n = 0; const t = setInterval(() => sub.next(n++), ms); return () => clearInterval(t); });
export const merge = (...sources) => new Observable((sub) => { const subs = sources.map((s) => s.subscribe({ next: (v) => sub.next(v), error: (e) => sub.error(e) })); return () => subs.forEach((s) => s.unsubscribe()); });
export const createMessageId = () => UUIDv4();
// ============================================================================
// TRANSPORT INVOKER FACTORIES
// ============================================================================
const makeInvoker = (transport, handler) => (subscriber) => {
    const send = createTransportSender(transport);
    const respond = (result, transfer) => send(result, transfer);
    return createTransportListener(transport, (data) => {
        if (!subscriber.active)
            return;
        handler ? handler(data, respond, subscriber) : subscriber.next(data);
    }, (err) => subscriber.error(err), () => subscriber.complete());
};
export const makeWorkerInvoker = (worker, handler) => makeInvoker(worker, handler);
export const makeMessagePortInvoker = (port, handler) => makeInvoker(port, handler);
export const makeBroadcastInvoker = (name, handler) => makeInvoker(new BroadcastChannel(name), handler);
export const makeWebSocketInvoker = (url, protocols, handler) => makeInvoker(new WebSocket(typeof url === "string" ? url : url.href, protocols), handler);
export const makeChromeRuntimeInvoker = (handler) => makeInvoker("chrome-runtime", handler);
export const makeServiceWorkerClientInvoker = (handler) => makeInvoker("service-worker-client", handler);
export const makeServiceWorkerHostInvoker = (handler) => makeInvoker("service-worker-host", handler);
export const makeSelfInvoker = (handler) => makeInvoker("self", handler);
export function createBidirectionalChannel(transport, channelName, handler) {
    const send = createTransportSender(transport);
    const inbound = new Observable((sub) => makeInvoker(transport, handler)(sub));
    return {
        inbound,
        outbound: { next: send },
        subscribe: (obs) => inbound.subscribe(obs),
        send: (value, transfer) => send(value, transfer)
    };
}
export function when(target, eventName) {
    return new Observable((sub) => {
        const h = (e) => sub.active && sub.next(e);
        target.addEventListener(eventName, h);
        return () => target.removeEventListener(eventName, h);
    });
}
// ============================================================================
// FACTORY
// ============================================================================
export const ObservableFactory = {
    channel: (transport, name) => new ChannelObservable(transport, name),
    invoker: (transport, name, handler) => createInvokerObservable(transport, name, handler),
    handler: (transport, name) => createInvokerObservable(transport, name, createReflectHandler(name)),
    bidirectional: createBidirectionalChannel,
    fromEvent,
    fromPromise,
    delay,
    interval,
    merge,
    when
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2JzZXJ2YWJsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk9ic2VydmFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFFSCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ25DLE9BQU8sRUFDSCxxQkFBcUIsRUFDckIsdUJBQXVCLEVBRzFCLE1BQU0sMEJBQTBCLENBQUM7QUFDbEMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBaUIxRCwrRUFBK0U7QUFDL0Usb0JBQW9CO0FBQ3BCLCtFQUErRTtBQUUvRSxNQUFNLGdCQUFnQjtJQUVFO0lBRFosT0FBTyxHQUFHLEtBQUssQ0FBQztJQUN4QixZQUFvQixZQUF3QjtRQUF4QixpQkFBWSxHQUFaLFlBQVksQ0FBWTtJQUFHLENBQUM7SUFDaEQsSUFBSSxNQUFNLEtBQWMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUM5QyxXQUFXLEtBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUFDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDM0Y7QUFFRCwrRUFBK0U7QUFDL0UsaUNBQWlDO0FBQ2pDLCtFQUErRTtBQUUvRTs7R0FFRztBQUNILE1BQU0sT0FBTyxVQUFVO0lBQ0M7SUFBcEIsWUFBb0IsU0FBc0I7UUFBdEIsY0FBUyxHQUFULFNBQVMsQ0FBYTtJQUFHLENBQUM7SUFFOUMsU0FBUyxDQUFDLGNBQStDLEVBQUUsSUFBK0I7UUFDdEYsTUFBTSxRQUFRLEdBQWdCLE9BQU8sY0FBYyxLQUFLLFVBQVU7WUFDOUQsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDO1FBRXRELE1BQU0sSUFBSSxHQUFH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LEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFdEwsTUFBTSxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUksQ0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQW9CLEVBQWlCLEVBQUUsQ0FDMUUsSUFBSSxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUFFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUUvTyxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsQ0FBSSxNQUF5QixFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQW9CLEVBQWlCLEVBQUUsQ0FDL0YsSUFBSSxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxHQUFHLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUUxUSxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBSSxFQUFVLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBb0IsRUFBaUIsRUFBRSxDQUMvRSxJQUFJLFVBQVUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxD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LEtBQUs7SUFDTCxRQUFRO0lBQ1IsS0FBSztJQUNMLElBQUk7Q0FDUCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPYnNlcnZhYmxlIENvcmUgLSBVbmlmaWVkIFdJQ0ctYWxpZ25lZCBPYnNlcnZhYmxlIGltcGxlbWVudGF0aW9uXG4gKlxuICogU2luZ2xlIHNvdXJjZSBvZiB0cnV0aCBmb3IgYWxsIE9ic2VydmFibGUgcHJpbWl0aXZlcy5cbiAqIFJlZmVyZW5jZTogaHR0cHM6Ly9naXRodWIuY29tL1dJQ0cvb2JzZXJ2YWJsZVxuICovXG5cbmltcG9ydCB7IFVVSUR2NCB9IGZyb20gXCJmZXN0L2NvcmVcIjtcbmltcG9ydCB7XG4gICAgY3JlYXRlVHJhbnNwb3J0U2VuZGVyLFxuICAgIGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyLFxuICAgIHR5cGUgVHJhbnNwb3J0VGFyZ2V0LFxuICAgIHR5cGUgU2VuZEZuXG59IGZyb20gXCIuLi8uLi9jb3JlL1RyYW5zcG9ydENvcmVcIjtcbmltcG9ydCB7IGhhbmRsZVJlcXVlc3QgfSBmcm9tIFwiLi4vLi4vY29yZS9SZXF1ZXN0SGFuZGxlclwiO1xuaW1wb3J0IHR5cGUge1xuICAgIE9ic2VydmVyLFxuICAgIFN1YnNjcmlwdGlvbixcbiAgICBTdWJzY3JpYmFibGUsXG4gICAgU3Vic2NyaWJlcixcbiAgICBQcm9kdWNlcixcbiAgICBDaGFubmVsTWVzc2FnZSxcbiAgICBSZXNwb25kZXJGbixcbiAgICBJbnZva2VySGFuZGxlcixcbiAgICBQZW5kaW5nUmVxdWVzdFxufSBmcm9tIFwiLi4vdHlwZXMvSW50ZXJmYWNlXCI7XG5pbXBvcnQgdHlwZSB7IFdSZXEgfSBmcm9tIFwiLi4vdHlwZXMvSW50ZXJmYWNlXCI7XG5cbi8vIFJlLWV4cG9ydCB0eXBlc1xuZXhwb3J0IHR5cGUgeyBPYnNlcnZlciwgU3Vic2NyaXB0aW9uLCBTdWJzY3JpYmFibGUsIFN1YnNjcmliZXIsIFByb2R1Y2VyLCBDaGFubmVsTWVzc2FnZSB9O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBCQVNFIFNVQlNDUklQVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jbGFzcyBCYXNlU3Vic2NyaXB0aW9uIGltcGxlbWVudHMgU3Vic2NyaXB0aW9uIHtcbiAgICBwcml2YXRlIF9jbG9zZWQgPSBmYWxzZTtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF91bnN1YnNjcmliZTogKCkgPT4gdm9pZCkge31cbiAgICBnZXQgY2xvc2VkKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fY2xvc2VkOyB9XG4gICAgdW5zdWJzY3JpYmUoKTogdm9pZCB7IGlmICghdGhpcy5fY2xvc2VkKSB7IHRoaXMuX2Nsb3NlZCA9IHRydWU7IHRoaXMuX3Vuc3Vic2NyaWJlKCk7IH0gfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT1JFIE9CU0VSVkFCTEUgKFdJQ0ctYWxpZ25lZClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBDb3JlIE9ic2VydmFibGUgd2l0aCBwcm9kdWNlciBmdW5jdGlvblxuICovXG5leHBvcnQgY2xhc3MgT2JzZXJ2YWJsZTxUID0gYW55PiBpbXBsZW1lbnRzIFN1YnNjcmliYWJsZTxUPiB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfcHJvZHVjZXI6IFByb2R1Y2VyPFQ+KSB7fVxuXG4gICAgc3Vic2NyaWJlKG9ic2VydmVyT3JOZXh0PzogT2JzZXJ2ZXI8VD4gfCAoKHY6IFQpID0+IHZvaWQpLCBvcHRzPzogeyBzaWduYWw/OiBBYm9ydFNpZ25hbCB9KTogU3Vic2NyaXB0aW9uIHtcbiAgICAgICAgY29uc3Qgb2JzZXJ2ZXI6IE9ic2VydmVyPFQ+ID0gdHlwZW9mIG9ic2VydmVyT3JOZXh0ID09PSBcImZ1bmN0aW9uXCJcbiAgICAgICAgICAgID8geyBuZXh0OiBvYnNlcnZlck9yTmV4dCB9IDogb2JzZXJ2ZXJPck5leHQgPz8ge307XG5cbiAgICAgICAgY29uc3QgY3RybCA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgb3B0cz8uc2lnbmFsPy5hZGRFdmVudExpc3RlbmVyKFwiYWJvcnRcIiwgKCkgPT4gY3RybC5hYm9ydCgpKTtcblxuICAgICAgICBsZXQgYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgbGV0IGNsZWFudXA6ICgoKSA9PiB2b2lkKSB8IHZvaWQ7XG5cbiAgICAgICAgY29uc3QgZG9DbGVhbnVwID0gKCkgPT4geyBhY3RpdmUgPSBmYWxzZTsgY3RybC5hYm9ydCgpOyBjbGVhbnVwPy4oKTsgfTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpYmVyOiBTdWJzY3JpYmVyPFQ+ID0ge1xuICAgICAgICAgICAgbmV4dDogKHYpID0+IGFjdGl2ZSAmJiBvYnNlcnZlci5uZXh0Py4odiksXG4gICAgICAgICAgICBlcnJvcjogKGUpID0+IHsgaWYgKGFjdGl2ZSkgeyBvYnNlcnZlci5lcnJvcj8uKGUpOyBkb0NsZWFudXAoKTsgfSB9LFxuICAgICAgICAgICAgY29tcGxldGU6ICgpID0+IHsgaWYgKGFjdGl2ZSkgeyBvYnNlcnZlci5jb21wbGV0ZT8uKCk7IGRvQ2xlYW51cCgpOyB9IH0sXG4gICAgICAgICAgICBzaWduYWw6IGN0cmwuc2lnbmFsLFxuICAgICAgICAgICAgZ2V0IGFjdGl2ZSgpIHsgcmV0dXJuIGFjdGl2ZSAmJiAhY3RybC5zaWduYWwuYWJvcnRlZDsgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRyeSB7IGNsZWFudXAgPSB0aGlzLl9wcm9kdWNlcihzdWJzY3JpYmVyKTsgfVxuICAgICAgICBjYXRjaCAoZSkgeyBzdWJzY3JpYmVyLmVycm9yKGUgYXMgRXJyb3IpOyB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBCYXNlU3Vic2NyaXB0aW9uKGRvQ2xlYW51cCk7XG4gICAgfVxuXG4gICAgcGlwZTxSPiguLi5vcHM6IEFycmF5PChzOiBPYnNlcnZhYmxlPGFueT4pID0+IE9ic2VydmFibGU8Uj4+KTogT2JzZXJ2YWJsZTxSPiB7XG4gICAgICAgIHJldHVybiBvcHMucmVkdWNlKChzLCBvcCkgPT4gb3AocyksIHRoaXMgYXMgdW5rbm93biBhcyBPYnNlcnZhYmxlPGFueT4pIGFzIE9ic2VydmFibGU8Uj47XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBTVUJKRUNUIChPYnNlcnZhYmxlIHdpdGggcHVzaClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJqZWN0T3B0aW9ucyB7IGJ1ZmZlclNpemU/OiBudW1iZXI7IHJlcGxheU9uU3Vic2NyaWJlPzogYm9vbGVhbjsgfVxuXG4vKipcbiAqIFN1YmplY3QgLSBPYnNlcnZhYmxlIHRoYXQgY2FuIGJlIHB1c2hlZCB0b1xuICovXG5leHBvcnQgY2xhc3MgQ2hhbm5lbFN1YmplY3Q8VCA9IGFueT4gaW1wbGVtZW50cyBTdWJzY3JpYmFibGU8VD4ge1xuICAgIHByb3RlY3RlZCBfc3VicyA9IG5ldyBTZXQ8T2JzZXJ2ZXI8VD4+KCk7XG4gICAgcHJpdmF0ZSBfYnVmZmVyOiBUW10gPSBbXTtcbiAgICBwcml2YXRlIF9tYXhCdWZmZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIF9yZXBsYXk6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBTdWJqZWN0T3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuX21heEJ1ZmZlciA9IG9wdGlvbnMuYnVmZmVyU2l6ZSA/PyAwO1xuICAgICAgICB0aGlzLl9yZXBsYXkgPSBvcHRpb25zLnJlcGxheU9uU3Vic2NyaWJlID8/IGZhbHNlO1xuICAgIH1cblxuICAgIG5leHQodmFsdWU6IFQpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX21heEJ1ZmZlciA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2J1ZmZlci5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9idWZmZXIubGVuZ3RoID4gdGhpcy5fbWF4QnVmZmVyKSB0aGlzLl9idWZmZXIuc2hpZnQoKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5fc3Vicykge1xuICAgICAgICAgICAgdHJ5IHsgcy5uZXh0Py4odmFsdWUpOyB9IGNhdGNoIChlKSB7IHMuZXJyb3I/LihlIGFzIEVycm9yKTsgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXJyb3IoZXJyOiBFcnJvcik6IHZvaWQgeyBmb3IgKGNvbnN0IHMgb2YgdGhpcy5fc3Vicykgcy5lcnJvcj8uKGVycik7IH1cbiAgICBjb21wbGV0ZSgpOiB2b2lkIHsgZm9yIChjb25zdCBzIG9mIHRoaXMuX3N1YnMpIHMuY29tcGxldGU/LigpOyB0aGlzLl9zdWJzLmNsZWFyKCk7IH1cblxuICAgIHN1YnNjcmliZShvYnNlcnZlck9yTmV4dDogT2JzZXJ2ZXI8VD4gfCAoKHY6IFQpID0+IHZvaWQpKTogU3Vic2NyaXB0aW9uIHtcbiAgICAgICAgY29uc3Qgb2JzOiBPYnNlcnZlcjxUPiA9IHR5cGVvZiBvYnNlcnZlck9yTmV4dCA9PT0gXCJmdW5jdGlvblwiID8geyBuZXh0OiBvYnNlcnZlck9yTmV4dCB9IDogb2JzZXJ2ZXJPck5leHQ7XG4gICAgICAgIHRoaXMuX3N1YnMuYWRkKG9icyk7XG5cbiAgICAgICAgaWYgKHRoaXMuX3JlcGxheSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHRoaXMuX2J1ZmZlcikgeyB0cnkgeyBvYnMubmV4dD8uKHYpOyB9IGNhdGNoIChlKSB7IG9icy5lcnJvcj8uKGUgYXMgRXJyb3IpOyB9IH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgQmFzZVN1YnNjcmlwdGlvbigoKSA9PiB7IHRoaXMuX3N1YnMuZGVsZXRlKG9icyk7IH0pO1xuICAgIH1cblxuICAgIGdldFZhbHVlKCk6IFQgfCB1bmRlZmluZWQgeyByZXR1cm4gdGhpcy5fYnVmZmVyLmF0KC0xKTsgfVxuICAgIGdldEJ1ZmZlcigpOiBUW10geyByZXR1cm4gWy4uLnRoaXMuX2J1ZmZlcl07IH1cbiAgICBnZXQgc3Vic2NyaWJlckNvdW50KCk6IG51bWJlciB7IHJldHVybiB0aGlzLl9zdWJzLnNpemU7IH1cbn1cblxuZXhwb3J0IGNsYXNzIFJlcGxheUNoYW5uZWxTdWJqZWN0PFQgPSBhbnk+IGV4dGVuZHMgQ2hhbm5lbFN1YmplY3Q8VD4ge1xuICAgIGNvbnN0cnVjdG9yKGJ1ZmZlclNpemUgPSAxKSB7IHN1cGVyKHsgYnVmZmVyU2l6ZSwgcmVwbGF5T25TdWJzY3JpYmU6IHRydWUgfSk7IH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ0hBTk5FTCBPQlNFUlZBQkxFICh3aXRoIHRyYW5zcG9ydCArIHJlcXVlc3QvcmVzcG9uc2UpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQ2hhbm5lbCBPYnNlcnZhYmxlIHdpdGggYmlkaXJlY3Rpb25hbCBjb21tdW5pY2F0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBDaGFubmVsT2JzZXJ2YWJsZSBpbXBsZW1lbnRzIFN1YnNjcmliYWJsZTxDaGFubmVsTWVzc2FnZT4ge1xuICAgIHByaXZhdGUgX3NlbmQ6IFNlbmRGbjxDaGFubmVsTWVzc2FnZT47XG4gICAgcHJpdmF0ZSBfcGVuZGluZyA9IG5ldyBNYXA8c3RyaW5nLCBQZW5kaW5nUmVxdWVzdD4oKTtcbiAgICBwcml2YXRlIF9zdWJzID0gbmV3IFNldDxPYnNlcnZlcjxDaGFubmVsTWVzc2FnZT4+KCk7XG4gICAgcHJpdmF0ZSBfY2xlYW51cDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBfbGlzdGVuaW5nID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF90cmFuc3BvcnQ6IFRyYW5zcG9ydFRhcmdldCwgcHJpdmF0ZSBfY2hhbm5lbE5hbWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLl9zZW5kID0gY3JlYXRlVHJhbnNwb3J0U2VuZGVyKF90cmFuc3BvcnQpO1xuICAgIH1cblxuICAgIG5leHQobXNnOiBDaGFubmVsTWVzc2FnZSwgdHJhbnNmZXI/OiBUcmFuc2ZlcmFibGVbXSk6IHZvaWQgeyB0aGlzLl9zZW5kKG1zZywgdHJhbnNmZXIpOyB9XG5cbiAgICBzdWJzY3JpYmUob2JzZXJ2ZXI6IE9ic2VydmVyPENoYW5uZWxNZXNzYWdlPiB8ICgodjogQ2hhbm5lbE1lc3NhZ2UpID0+IHZvaWQpKTogU3Vic2NyaXB0aW9uIHtcbiAgICAgICAgY29uc3Qgb2JzOiBPYnNlcnZlcjxDaGFubmVsTWVzc2FnZT4gPSB0eXBlb2Ygb2JzZXJ2ZXIgPT09IFwiZnVuY3Rpb25cIiA/IHsgbmV4dDogb2JzZXJ2ZXIgfSA6IG9ic2VydmVyO1xuICAgICAgICB0aGlzLl9zdWJzLmFkZChvYnMpO1xuICAgICAgICBpZiAoIXRoaXMuX2xpc3RlbmluZykgdGhpcy5fYWN0aXZhdGUoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBCYXNlU3Vic2NyaXB0aW9uKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3N1YnMuZGVsZXRlKG9icyk7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3Vicy5zaXplID09PSAwKSB0aGlzLl9kZWFjdGl2YXRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlcXVlc3QobXNnOiBPbWl0PENoYW5uZWxNZXNzYWdlLCBcInJlcUlkXCI+ICYgeyByZXFJZD86IHN0cmluZyB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgcmVxSWQgPSBtc2cucmVxSWQgPz8gVVVJRHY0KCk7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9wZW5kaW5nLnNldChyZXFJZCwgeyByZXNvbHZlLCByZWplY3QsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTtcbiAgICAgICAgICAgIHRoaXMubmV4dCh7IC4uLm1zZywgcmVxSWQgfSBhcyBDaGFubmVsTWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2hhbmRsZShkYXRhOiBDaGFubmVsTWVzc2FnZSk6IHZvaWQge1xuICAgICAgICBpZiAoZGF0YS50eXBlID09PSBcInJlc3BvbnNlXCIgJiYgZGF0YS5yZXFJZCkge1xuICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuX3BlbmRpbmcuZ2V0KGRhdGEucmVxSWQpO1xuICAgICAgICAgICAgaWYgKHApIHsgcC5yZXNvbHZlKGRhdGEucGF5bG9hZCk7IHRoaXMuX3BlbmRpbmcuZGVsZXRlKGRhdGEucmVxSWQpOyB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBzIG9mIHRoaXMuX3N1YnMpIHsgdHJ5IHsgcy5uZXh0Py4oZGF0YSk7IH0gY2F0Y2ggKGUpIHsgcy5lcnJvcj8uKGUgYXMgRXJyb3IpOyB9IH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9hY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmluZykgcmV0dXJuO1xuICAgICAgICB0aGlzLl9jbGVhbnVwID0gY3JlYXRlVHJhbnNwb3J0TGlzdGVuZXIoXG4gICAgICAgICAgICB0aGlzLl90cmFuc3BvcnQsXG4gICAgICAgICAgICAoZCkgPT4gdGhpcy5faGFuZGxlKGQpLFxuICAgICAgICAgICAgKGUpID0+IHRoaXMuX3N1YnMuZm9yRWFjaCgocykgPT4gcy5lcnJvcj8uKGUpKSxcbiAgICAgICAgICAgICgpID0+IHRoaXMuX3N1YnMuZm9yRWFjaCgocykgPT4gcy5jb21wbGV0ZT8uKCkpXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX2xpc3RlbmluZyA9IHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZGVhY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fY2xlYW51cD8uKCk7IHRoaXMuX2NsZWFudXAgPSBudWxsOyB0aGlzLl9saXN0ZW5pbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBjbG9zZSgpOiB2b2lkIHsgdGhpcy5fc3Vicy5mb3JFYWNoKChzKSA9PiBzLmNvbXBsZXRlPy4oKSk7IHRoaXMuX3N1YnMuY2xlYXIoKTsgdGhpcy5fZGVhY3RpdmF0ZSgpOyB9XG4gICAgZ2V0IGNoYW5uZWxOYW1lKCk6IHN0cmluZyB7IHJldHVybiB0aGlzLl9jaGFubmVsTmFtZTsgfVxuICAgIGdldCBpc0xpc3RlbmluZygpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMuX2xpc3RlbmluZzsgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJTlZPS0VSIE9CU0VSVkFCTEVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUludm9rZXJPYnNlcnZhYmxlKFxuICAgIHRyYW5zcG9ydDogVHJhbnNwb3J0VGFyZ2V0LFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENoYW5uZWxNZXNzYWdlPlxuKTogT2JzZXJ2YWJsZTxDaGFubmVsTWVzc2FnZT4ge1xuICAgIGNvbnN0IHNlbmQgPSBjcmVhdGVUcmFuc3BvcnRTZW5kZXIodHJhbnNwb3J0KTtcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKHN1YnNjcmliZXIpID0+IHtcbiAgICAgICAgY29uc3Qgb25NZXNzYWdlID0gKGRhdGE6IENoYW5uZWxNZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXN1YnNjcmliZXIuYWN0aXZlKSByZXR1cm47XG4gICAgICAgICAgICBjb25zdCByZXNwb25kOiBSZXNwb25kZXJGbjxDaGFubmVsTWVzc2FnZT4gPSAocmVzdWx0LCB0cmFuc2ZlcikgPT4ge1xuICAgICAgICAgICAgICAgIHNlbmQoeyAuLi5yZXN1bHQsIGNoYW5uZWw6IGRhdGEuc2VuZGVyLCBzZW5kZXI6IGNoYW5uZWxOYW1lLCB0eXBlOiBcInJlc3BvbnNlXCIsIHJlcUlkOiBkYXRhLnJlcUlkIH0sIHRyYW5zZmVyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBoYW5kbGVyID8gaGFuZGxlcihkYXRhLCByZXNwb25kLCBzdWJzY3JpYmVyKSA6IHN1YnNjcmliZXIubmV4dChkYXRhKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKHRyYW5zcG9ydCwgb25NZXNzYWdlLCAoZSkgPT4gc3Vic2NyaWJlci5lcnJvcihlKSwgKCkgPT4gc3Vic2NyaWJlci5jb21wbGV0ZSgpKTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlZmxlY3RIYW5kbGVyKGNoYW5uZWxOYW1lOiBzdHJpbmcpOiBJbnZva2VySGFuZGxlcjxDaGFubmVsTWVzc2FnZT4ge1xuICAgIHJldHVybiBhc3luYyAoZGF0YSwgcmVzcG9uZCwgc3Vic2NyaWJlcikgPT4ge1xuICAgICAgICBpZiAoZGF0YS50eXBlICE9PSBcInJlcXVlc3RcIikgeyBzdWJzY3JpYmVyLm5leHQoZGF0YSk7IHJldHVybjsgfVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVSZXF1ZXN0KGRhdGEucGF5bG9hZCBhcyBXUmVxLCBkYXRhLnJlcUlkISwgY2hhbm5lbE5hbWUpO1xuICAgICAgICBpZiAocmVzdWx0KSByZXNwb25kKHJlc3VsdC5yZXNwb25zZSwgcmVzdWx0LnRyYW5zZmVyKTtcbiAgICAgICAgc3Vic2NyaWJlci5uZXh0KGRhdGEpO1xuICAgIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1FU1NBR0UgT0JTRVJWQUJMRSAoZmlsdGVyZWQgYnkgdHlwZSlcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNsYXNzIE1lc3NhZ2VPYnNlcnZhYmxlIGV4dGVuZHMgQ2hhbm5lbFN1YmplY3Q8Q2hhbm5lbE1lc3NhZ2U+IHtcbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2U6IFN1YnNjcmliYWJsZTxDaGFubmVsTWVzc2FnZT4sIG1lc3NhZ2VUeXBlPzogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHNvdXJjZS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgbmV4dDogKG1zZykgPT4geyBpZiAoIW1lc3NhZ2VUeXBlIHx8IG1zZy50eXBlID09PSBtZXNzYWdlVHlwZSkgdGhpcy5uZXh0KG1zZyk7IH0sXG4gICAgICAgICAgICBlcnJvcjogKGUpID0+IHRoaXMuZXJyb3IoZSksXG4gICAgICAgICAgICBjb21wbGV0ZTogKCkgPT4gdGhpcy5jb21wbGV0ZSgpXG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gT1BFUkFUT1JTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBmaWx0ZXIgPSA8VD4ocHJlZDogKHY6IFQpID0+IGJvb2xlYW4pID0+IChzcmM6IFN1YnNjcmliYWJsZTxUPik6IE9ic2VydmFibGU8VD4gPT5cbiAgICBuZXcgT2JzZXJ2YWJsZSgoc3ViKSA9PiB7IGNvbnN0IHMgPSBzcmMuc3Vic2NyaWJlKHsgbmV4dDogKHYpID0+IHByZWQodikgJiYgc3ViLm5leHQodiksIGVycm9yOiAoZSkgPT4gc3ViLmVycm9yKGUpLCBjb21wbGV0ZTogKCkgPT4gc3ViLmNvbXBsZXRlKCkgfSk7IHJldHVybiAoKSA9PiBzLnVuc3Vic2NyaWJlKCk7IH0pO1xuXG5leHBvcnQgY29uc3QgbWFwID0gPFQsIFI+KGZuOiAodjogVCkgPT4gUikgPT4gKHNyYzogU3Vic2NyaWJhYmxlPFQ+KTogT2JzZXJ2YWJsZTxSPiA9PlxuICAgIG5ldyBPYnNlcnZhYmxlKChzdWIpID0+IHsgY29uc3QgcyA9IHNyYy5zdWJzY3JpYmUoeyBuZXh0OiAodikgPT4gc3ViLm5leHQoZm4odikpLCBlcnJvcjogKGUpID0+IHN1Yi5lcnJvcihlKSwgY29tcGxldGU6ICgpID0+IHN1Yi5jb21wbGV0ZSgpIH0pOyByZXR1cm4gKCkgPT4gcy51bnN1YnNjcmliZSgpOyB9KTtcblxuZXhwb3J0IGNvbnN0IHRha2UgPSA8VD4objogbnVtYmVyKSA9PiAoc3JjOiBTdWJzY3JpYmFibGU8VD4pOiBPYnNlcnZhYmxlPFQ+ID0+XG4gICAgbmV3IE9ic2VydmFibGUoKHN1YikgPT4geyBsZXQgYyA9IDA7IGNvbnN0IHMgPSBzcmMuc3Vic2NyaWJlKHsgbmV4dDogKHYpID0+IHsgaWYgKGMrKyA8IG4pIHsgc3ViLm5leHQodik7IGlmIChjID49IG4pIHN1Yi5jb21wbGV0ZSgpOyB9IH0sIGVycm9yOiAoZSkgPT4gc3ViLmVycm9yKGUpLCBjb21wbGV0ZTogKCkgPT4gc3ViLmNvbXBsZXRlKCkgfSk7IHJldHVybiAoKSA9PiBzLnVuc3Vic2NyaWJlKCk7IH0pO1xuXG5leHBvcnQgY29uc3QgdGFrZVVudGlsID0gPFQ+KHNpZ25hbDogU3Vic2NyaWJhYmxlPGFueT4pID0+IChzcmM6IFN1YnNjcmliYWJsZTxUPik6IE9ic2VydmFibGU8VD4gPT5cbiAgICBuZXcgT2JzZXJ2YWJsZSgoc3ViKSA9PiB7IGNvbnN0IHNzID0gc3JjLnN1YnNjcmliZSh7IG5leHQ6ICh2KSA9PiBzdWIubmV4dCh2KSwgZXJyb3I6IChlKSA9PiBzdWIuZXJyb3IoZSksIGNvbXBsZXRlOiAoKSA9PiBzdWIuY29tcGxldGUoKSB9KTsgY29uc3Qgc2lnID0gc2lnbmFsLnN1YnNjcmliZSh7IG5leHQ6ICgpID0+IHN1Yi5jb21wbGV0ZSgpIH0pOyByZXR1cm4gKCkgPT4geyBzcy51bnN1YnNjcmliZSgpOyBzaWcudW5zdWJzY3JpYmUoKTsgfTsgfSk7XG5cbmV4cG9ydCBjb25zdCBkZWJvdW5jZSA9IDxUPihtczogbnVtYmVyKSA9PiAoc3JjOiBTdWJzY3JpYmFibGU8VD4pOiBPYnNlcnZhYmxlPFQ+ID0+XG4gICAgbmV3IE9ic2VydmFibGUoKHN1YikgPT4geyBsZXQgdDogYW55OyBjb25zdCBzID0gc3JjLnN1YnNjcmliZSh7IG5leHQ6ICh2KSA9PiB7IGNsZWFyVGltZW91dCh0KTsgdCA9IHNldFRpbWVvdXQoKCkgPT4gc3ViLm5leHQodiksIG1zKTsgfSwgZXJyb3I6IChlKSA9PiBzdWIuZXJyb3IoZSksIGNvbXBsZXRlOiAoKSA9PiBzdWIuY29tcGxldGUoKSB9KTsgcmV0dXJuICgpID0+IHsgY2xlYXJUaW1lb3V0KHQpOyBzLnVuc3Vic2NyaWJlKCk7IH07IH0pO1xuXG5leHBvcnQgY29uc3QgdGhyb3R0bGUgPSA8VD4obXM6IG51bWJlcikgPT4gKHNyYzogU3Vic2NyaWJhYmxlPFQ+KTogT2JzZXJ2YWJsZTxUPiA9PlxuICAgIG5ldyBPYnNlcnZhYmxlKChzdWIpID0+IHsgbGV0IGxhc3QgPSAwOyBjb25zdCBzID0gc3JjLnN1YnNjcmliZSh7IG5leHQ6ICh2KSA9PiB7IGNvbnN0IG5vdyA9IERhdGUubm93KCk7IGlmIChub3cgLSBsYXN0ID49IG1zKSB7IGxhc3QgPSBub3c7IHN1Yi5uZXh0KHYpOyB9IH0sIGVycm9yOiAoZSkgPT4gc3ViLmVycm9yKGUpLCBjb21wbGV0ZTogKCkgPT4gc3ViLmNvbXBsZXRlKCkgfSk7IHJldHVybiAoKSA9PiBzLnVuc3Vic2NyaWJlKCk7IH0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBVVElMSVRJRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGNvbnN0IGZyb21FdmVudCA9IDxLIGV4dGVuZHMga2V5b2YgSFRNTEVsZW1lbnRFdmVudE1hcD4odGFyZ2V0OiBFdmVudFRhcmdldCwgZXZlbnQ6IEspOiBPYnNlcnZhYmxlPEhUTUxFbGVtZW50RXZlbnRNYXBbS10+ID0+XG4gICAgbmV3IE9ic2VydmFibGUoKHN1YikgPT4geyBjb25zdCBoID0gKGU6IEV2ZW50KSA9PiBzdWIuYWN0aXZlICYmIHN1Yi5uZXh0KGUgYXMgSFRNTEVsZW1lbnRFdmVudE1hcFtLXSk7IHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoKTsgcmV0dXJuICgpID0+IHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoKTsgfSk7XG5cbmV4cG9ydCBjb25zdCBmcm9tUHJvbWlzZSA9IDxUPihwcm9taXNlOiBQcm9taXNlPFQ+KTogT2JzZXJ2YWJsZTxUPiA9PlxuICAgIG5ldyBPYnNlcnZhYmxlKChzdWIpID0+IHsgcHJvbWlzZS50aGVuKCh2KSA9PiB7IHN1Yi5uZXh0KHYpOyBzdWIuY29tcGxldGUoKTsgfSkuY2F0Y2goKGUpID0+IHN1Yi5lcnJvcihlKSk7IH0pO1xuXG5leHBvcnQgY29uc3QgZGVsYXkgPSA8VD4odmFsdWU6IFQsIG1zOiBudW1iZXIpOiBPYnNlcnZhYmxlPFQ+ID0+XG4gICAgbmV3IE9ic2VydmFibGUoKHN1YikgPT4geyBjb25zdCB0ID0gc2V0VGltZW91dCgoKSA9PiB7IHN1Yi5uZXh0KHZhbHVlKTsgc3ViLmNvbXBsZXRlKCk7IH0sIG1zKTsgcmV0dXJuICgpID0+IGNsZWFyVGltZW91dCh0KTsgfSk7XG5cbmV4cG9ydCBjb25zdCBpbnRlcnZhbCA9IChtczogbnVtYmVyKTogT2JzZXJ2YWJsZTxudW1iZXI+ID0+XG4gICAgbmV3IE9ic2VydmFibGUoKHN1YikgPT4geyBsZXQgbiA9IDA7IGNvbnN0IHQgPSBzZXRJbnRlcnZhbCgoKSA9PiBzdWIubmV4dChuKyspLCBtcyk7IHJldHVybiAoKSA9PiBjbGVhckludGVydmFsKHQpOyB9KTtcblxuZXhwb3J0IGNvbnN0IG1lcmdlID0gPFQ+KC4uLnNvdXJjZXM6IFN1YnNjcmliYWJsZTxUPltdKTogT2JzZXJ2YWJsZTxUPiA9PlxuICAgIG5ldyBPYnNlcnZhYmxlKChzdWIpID0+IHsgY29uc3Qgc3VicyA9IHNvdXJjZXMubWFwKChzKSA9PiBzLnN1YnNjcmliZSh7IG5leHQ6ICh2KSA9PiBzdWIubmV4dCh2KSwgZXJyb3I6IChlKSA9PiBzdWIuZXJyb3IoZSkgfSkpOyByZXR1cm4gKCkgPT4gc3Vicy5mb3JFYWNoKChzKSA9PiBzLnVuc3Vic2NyaWJlKCkpOyB9KTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZU1lc3NhZ2VJZCA9ICgpOiBzdHJpbmcgPT4gVVVJRHY0KCk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRSQU5TUE9SVCBJTlZPS0VSIEZBQ1RPUklFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBtYWtlSW52b2tlciA9ICh0cmFuc3BvcnQ6IFRyYW5zcG9ydFRhcmdldCwgaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENoYW5uZWxNZXNzYWdlPikgPT5cbiAgICAoc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxDaGFubmVsTWVzc2FnZT4pOiAoKSA9PiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgc2VuZCA9IGNyZWF0ZVRyYW5zcG9ydFNlbmRlcih0cmFuc3BvcnQpO1xuICAgICAgICBjb25zdCByZXNwb25kOiBSZXNwb25kZXJGbjxDaGFubmVsTWVzc2FnZT4gPSAocmVzdWx0LCB0cmFuc2ZlcikgPT4gc2VuZChyZXN1bHQsIHRyYW5zZmVyKTtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVRyYW5zcG9ydExpc3RlbmVyKFxuICAgICAgICAgICAgdHJhbnNwb3J0LFxuICAgICAgICAgICAgKGRhdGE6IENoYW5uZWxNZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFzdWJzY3JpYmVyLmFjdGl2ZSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGhhbmRsZXIgPyBoYW5kbGVyKGRhdGEsIHJlc3BvbmQsIHN1YnNjcmliZXIpIDogc3Vic2NyaWJlci5uZXh0KGRhdGEpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnIpID0+IHN1YnNjcmliZXIuZXJyb3IoZXJyKSxcbiAgICAgICAgICAgICgpID0+IHN1YnNjcmliZXIuY29tcGxldGUoKVxuICAgICAgICApO1xuICAgIH07XG5cbmV4cG9ydCBjb25zdCBtYWtlV29ya2VySW52b2tlciA9ICh3b3JrZXI6IFdvcmtlciwgaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENoYW5uZWxNZXNzYWdlPikgPT4gbWFrZUludm9rZXIod29ya2VyLCBoYW5kbGVyKTtcbmV4cG9ydCBjb25zdCBtYWtlTWVzc2FnZVBvcnRJbnZva2VyID0gKHBvcnQ6IE1lc3NhZ2VQb3J0LCBoYW5kbGVyPzogSW52b2tlckhhbmRsZXI8Q2hhbm5lbE1lc3NhZ2U+KSA9PiBtYWtlSW52b2tlcihwb3J0LCBoYW5kbGVyKTtcbmV4cG9ydCBjb25zdCBtYWtlQnJvYWRjYXN0SW52b2tlciA9IChuYW1lOiBzdHJpbmcsIGhhbmRsZXI/OiBJbnZva2VySGFuZGxlcjxDaGFubmVsTWVzc2FnZT4pID0+IG1ha2VJbnZva2VyKG5ldyBCcm9hZGNhc3RDaGFubmVsKG5hbWUpLCBoYW5kbGVyKTtcbmV4cG9ydCBjb25zdCBtYWtlV2ViU29ja2V0SW52b2tlciA9ICh1cmw6IHN0cmluZyB8IFVSTCwgcHJvdG9jb2xzPzogc3RyaW5nIHwgc3RyaW5nW10sIGhhbmRsZXI/OiBJbnZva2VySGFuZGxlcjxDaGFubmVsTWVzc2FnZT4pID0+XG4gICAgbWFrZUludm9rZXIobmV3IFdlYlNvY2tldCh0eXBlb2YgdXJsID09PSBcInN0cmluZ1wiID8gdXJsIDogdXJsLmhyZWYsIHByb3RvY29scyksIGhhbmRsZXIpO1xuZXhwb3J0IGNvbnN0IG1ha2VDaHJvbWVSdW50aW1lSW52b2tlciA9IChoYW5kbGVyPzogSW52b2tlckhhbmRsZXI8Q2hhbm5lbE1lc3NhZ2U+KSA9PiBtYWtlSW52b2tlcihcImNocm9tZS1ydW50aW1lXCIgYXMgVHJhbnNwb3J0VGFyZ2V0LCBoYW5kbGVyKTtcbmV4cG9ydCBjb25zdCBtYWtlU2VydmljZVdvcmtlckNsaWVudEludm9rZXIgPSAoaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENoYW5uZWxNZXNzYWdlPikgPT4gbWFrZUludm9rZXIoXCJzZXJ2aWNlLXdvcmtlci1jbGllbnRcIiBhcyBUcmFuc3BvcnRUYXJnZXQsIGhhbmRsZXIpO1xuZXhwb3J0IGNvbnN0IG1ha2VTZXJ2aWNlV29ya2VySG9zdEludm9rZXIgPSAoaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENoYW5uZWxNZXNzYWdlPikgPT4gbWFrZUludm9rZXIoXCJzZXJ2aWNlLXdvcmtlci1ob3N0XCIgYXMgVHJhbnNwb3J0VGFyZ2V0LCBoYW5kbGVyKTtcbmV4cG9ydCBjb25zdCBtYWtlU2VsZkludm9rZXIgPSAoaGFuZGxlcj86IEludm9rZXJIYW5kbGVyPENoYW5uZWxNZXNzYWdlPikgPT4gbWFrZUludm9rZXIoXCJzZWxmXCIgYXMgVHJhbnNwb3J0VGFyZ2V0LCBoYW5kbGVyKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQklESVJFQ1RJT05BTCBDSEFOTkVMXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmlkaXJlY3Rpb25hbENoYW5uZWw8VCA9IENoYW5uZWxNZXNzYWdlPiB7XG4gICAgaW5ib3VuZDogT2JzZXJ2YWJsZTxUPjtcbiAgICBvdXRib3VuZDogeyBuZXh0KHZhbHVlOiBULCB0cmFuc2Zlcj86IFRyYW5zZmVyYWJsZVtdKTogdm9pZCB9O1xuICAgIHN1YnNjcmliZShvYnNlcnZlcjogT2JzZXJ2ZXI8VD4pOiBTdWJzY3JpcHRpb247XG4gICAgc2VuZCh2YWx1ZTogVCwgdHJhbnNmZXI/OiBUcmFuc2ZlcmFibGVbXSk6IHZvaWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCaWRpcmVjdGlvbmFsQ2hhbm5lbChcbiAgICB0cmFuc3BvcnQ6IFRyYW5zcG9ydFRhcmdldCxcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxuICAgIGhhbmRsZXI/OiBJbnZva2VySGFuZGxlcjxDaGFubmVsTWVzc2FnZT5cbik6IEJpZGlyZWN0aW9uYWxDaGFubmVsPENoYW5uZWxNZXNzYWdlPiB7XG4gICAgY29uc3Qgc2VuZCA9IGNyZWF0ZVRyYW5zcG9ydFNlbmRlcih0cmFuc3BvcnQpO1xuICAgIGNvbnN0IGluYm91bmQgPSBuZXcgT2JzZXJ2YWJsZTxDaGFubmVsTWVzc2FnZT4oKHN1YikgPT4gbWFrZUludm9rZXIodHJhbnNwb3J0LCBoYW5kbGVyKShzdWIpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbmJvdW5kLFxuICAgICAgICBvdXRib3VuZDogeyBuZXh0OiBzZW5kIH0sXG4gICAgICAgIHN1YnNjcmliZTogKG9icykgPT4gaW5ib3VuZC5zdWJzY3JpYmUob2JzKSxcbiAgICAgICAgc2VuZDogKHZhbHVlLCB0cmFuc2ZlcikgPT4gc2VuZCh2YWx1ZSwgdHJhbnNmZXIpXG4gICAgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRVZFTlQgVVRJTElUWVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gd2hlbjxLIGV4dGVuZHMga2V5b2YgSFRNTEVsZW1lbnRFdmVudE1hcD4odGFyZ2V0OiBFdmVudFRhcmdldCwgZXZlbnROYW1lOiBLKTogT2JzZXJ2YWJsZTxIVE1MRWxlbWVudEV2ZW50TWFwW0tdPjtcbmV4cG9ydCBmdW5jdGlvbiB3aGVuKHRhcmdldDogRXZlbnRUYXJnZXQsIGV2ZW50TmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxFdmVudD47XG5leHBvcnQgZnVuY3Rpb24gd2hlbih0YXJnZXQ6IEV2ZW50VGFyZ2V0LCBldmVudE5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8RXZlbnQ+IHtcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKHN1YikgPT4ge1xuICAgICAgICBjb25zdCBoID0gKGU6IEV2ZW50KSA9PiBzdWIuYWN0aXZlICYmIHN1Yi5uZXh0KGUpO1xuICAgICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGgpO1xuICAgICAgICByZXR1cm4gKCkgPT4gdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoKTtcbiAgICB9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRkFDVE9SWVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY29uc3QgT2JzZXJ2YWJsZUZhY3RvcnkgPSB7XG4gICAgY2hhbm5lbDogKHRyYW5zcG9ydDogVHJhbnNwb3J0VGFyZ2V0LCBuYW1lOiBzdHJpbmcpID0+IG5ldyBDaGFubmVsT2JzZXJ2YWJsZSh0cmFuc3BvcnQsIG5hbWUpLFxuICAgIGludm9rZXI6ICh0cmFuc3BvcnQ6IFRyYW5zcG9ydFRhcmdldCwgbmFtZTogc3RyaW5nLCBoYW5kbGVyPzogSW52b2tlckhhbmRsZXI8Q2hhbm5lbE1lc3NhZ2U+KSA9PiBjcmVhdGVJbnZva2VyT2JzZXJ2YWJsZSh0cmFuc3BvcnQsIG5hbWUsIGhhbmRsZXIpLFxuICAgIGhhbmRsZXI6ICh0cmFuc3BvcnQ6IFRyYW5zcG9ydFRhcmdldCwgbmFtZTogc3RyaW5nKSA9PiBjcmVhdGVJbnZva2VyT2JzZXJ2YWJsZSh0cmFuc3BvcnQsIG5hbWUsIGNyZWF0ZVJlZmxlY3RIYW5kbGVyKG5hbWUpKSxcbiAgICBiaWRpcmVjdGlvbmFsOiBjcmVhdGVCaWRpcmVjdGlvbmFsQ2hhbm5lbCxcbiAgICBmcm9tRXZlbnQsXG4gICAgZnJvbVByb21pc2UsXG4gICAgZGVsYXksXG4gICAgaW50ZXJ2YWwsXG4gICAgbWVyZ2UsXG4gICAgd2hlblxufTtcbiJdfQ==